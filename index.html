<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Квиз • ШАГАЙ ДОМА ⚡</title>
<meta name="color-scheme" content="light only"/>
<style>
:root{--r:#cf2c02;--o:#e85d04;--y:#ffba08;--g:#e6e6e6;--txt:#111}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--txt);background:#fff}
.hidden{display:none!important}
.app{max-width:960px;margin:0 auto;padding:16px}
.card{background:#fff;border-radius:22px;box-shadow:0 10px 30px rgba(0,0,0,.08);padding:16px}

/* screens */
.screen{display:none;animation:.28s fadeUp ease both}
.screen.is{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
h1{font-size:clamp(22px,5vw,36px);line-height:1.15;margin:8px 0 10px}
h2{font-size:clamp(20px,4.6vw,30px);line-height:1.18;margin:6px 0 12px}
.hint{color:#666}
.grid{display:grid;gap:10px}.cols2{grid-template-columns:1fr 1fr}
@media(max-width:620px){.cols2{grid-template-columns:1fr}}

/* inputs */
.text{width:100%;border:2px solid var(--g);border-radius:12px;padding:12px 14px;font-size:1rem}
.opt{border:2px solid var(--g);border-radius:14px;padding:12px;cursor:pointer;background:#fff}
.opt.is{border-color:var(--o);box-shadow:0 8px 18px rgba(232,93,4,.14)}
.opt--img{display:flex;flex-direction:column;align-items:center;text-align:center}
.opt--img img{width:100%;height:180px;object-fit:contain;background:#fafafa;border-radius:12px}
.opt--img span{margin-top:8px;font-weight:700}
.chips{display:flex;flex-wrap:wrap;gap:8px}
.chip{border:2px solid var(--g);border-radius:999px;padding:9px 12px;background:#fff;cursor:pointer}
.chip.is{border-color:var(--o);box-shadow:0 6px 16px rgba(232,93,4,.12)}
.actions{display:flex;gap:8px;margin-top:12px}
.btn{border:none;border-radius:12px;padding:12px 16px;font-weight:800;cursor:pointer}
.primary{background:linear-gradient(135deg,var(--r),var(--o));color:#fff;box-shadow:0 10px 18px rgba(207,44,2,.25)}
.ghost{background:#fff;border:2px solid var(--g)}
.sticky{position:sticky;bottom:0;background:linear-gradient(0deg,#fff 60%, rgba(255,255,255,0));padding-top:8px;z-index:5}

/* progress / discount */
#progress{display:flex;align-items:center;gap:10px;margin:0 0 12px}
#progress.hide{display:none!important}
.discbox{display:flex;align-items:center;gap:10px;border:2px solid #ffd7c7;background:#fff7ef;border-radius:14px;padding:8px 12px}
.discbox .title{font-weight:800}
.discbox .value{font-weight:900;font-size:1.15rem}
.disc-tip{position:relative;width:18px;height:18px;border-radius:50%;display:grid;place-items:center;background:var(--y);font-weight:800}
.disc-tip .tt{position:absolute;left:50%;bottom:140%;transform:translateX(-50%);background:#111;color:#fff;padding:6px 8px;border-radius:8px;font-size:.84rem;white-space:nowrap;opacity:0;pointer-events:none}
.disc-tip:hover .tt{opacity:1}

/* slider steps */
#steps{--pct:0%;width:100%;height:40px;background:transparent}
#steps::-webkit-slider-runnable-track{height:12px;border-radius:999px;background:linear-gradient(90deg,var(--o) 0 var(--pct),#eee var(--pct))}
#steps::-webkit-slider-thumb{-webkit-appearance:none;width:28px;height:28px;border:3px solid var(--o);background:#fff;border-radius:50%;margin-top:-8px}

/* goal */
.goal-badge{display:inline-block;padding:4px 8px;border-radius:999px;font-weight:700;font-size:.85rem}
.goal-soft{background:#e8f7ee;color:#0d7d46}
.goal-mid{background:#fff3cc;color:#9a6b00}
.goal-hard{background:#ffe9e6;color:#a11000}

/* habits meter */
.habit-meter{border:2px solid var(--g);border-radius:14px;padding:12px}
.hm-track{--p:50%;position:relative;height:12px;border-radius:999px;background:linear-gradient(90deg,#ffe2db 0,#fff8e5 50%,#e6f7ef 100%)}
.hm-pointer{position:absolute;top:50%;left:var(--p);transform:translate(-50%,-50%);width:16px;height:16px;border-radius:50%;background:#fff;border:3px solid var(--o)}
.hm-badge{display:inline-block;padding:4px 8px;border-radius:999px;font-size:.85rem;font-weight:700}

/* HARD question (fixed) */
.hcard{border:2px solid var(--g);border-radius:14px;padding:12px;background:#fff;cursor:pointer}
.hcard.is{border-color:var(--o);box-shadow:0 8px 18px rgba(232,93,4,.14)}
.hhead{display:flex;align-items:center;gap:10px;font-weight:700}
.hicon{width:28px;height:28px;display:grid;place-items:center;background:#fff2ec;border:1px solid #ffd5c2;border-radius:999px}

/* deal + timer */
.deal-row{display:flex;align-items:center;gap:10px;justify-content:space-between;flex-wrap:wrap}
.deal-badge{display:inline-block;padding:6px 10px;border-radius:999px;border:2px solid #ffd7c7;background:#fff7ef;font-weight:800}
.deal-timer{font-weight:900;border:2px solid #ddd;border-radius:10px;padding:6px 10px;min-width:72px;text-align:center}

/* player tabs */
.p-tabs{display:flex;gap:8px;margin:6px 0 8px}
.p-btn{border:2px solid #ddd;border-radius:999px;background:#fff;padding:6px 10px;font-weight:700;cursor:pointer}
.p-btn.is{border-color:#ffd7c7;background:#fff7ef}
.player{position:relative;width:100%;aspect-ratio:16/9;border-radius:16px;overflow:hidden;background:#000}
.player iframe{position:absolute;inset:0;width:100%;height:100%;border:0}

/* Program select */
.pgrid{display:grid;gap:12px;grid-template-columns:1fr 1fr}
@media(max-width:760px){.pgrid{grid-template-columns:1fr}}
.pcard{position:relative;border:2px solid var(--g);border-radius:16px;background:#fff;padding:14px}
.pcard.is{border-color:var(--o);box-shadow:0 10px 24px rgba(232,93,4,.18);background:linear-gradient(180deg,#fff,#fff9f3)}
.pcard h3{margin:0 0 4px}
.pcard .tag{display:inline-block;border:1px solid #ffd7c7;background:#fff7ef;border-radius:999px;padding:4px 8px;font-weight:700;margin-right:6px}
.pcard .meta{color:#555;font-size:.92rem}
.pcard .rec{position:absolute;top:10px;right:10px;background:#12a06a;color:#fff;border-radius:999px;padding:4px 8px;font-weight:800;font-size:.82rem}

/* week */
.week-grid{display:grid;gap:10px;grid-template-columns:repeat(7,1fr)}
@media(max-width:840px){.week-grid{grid-template-columns:repeat(4,1fr)}}
@media(max-width:540px){.week-grid{grid-template-columns:repeat(2,1fr)}}
.day{border:2px solid var(--g);border-radius:14px;padding:10px;background:#fff}
.badge{display:inline-block;padding:4px 8px;border-radius:999px;font-size:.8rem;font-weight:700}
.badge-tr{background:#fff2ec;color:#b34009;border:1px solid #ffd5c2}
.badge-rest{background:#eef8f3;color:#0f7a42;border:1px solid #cfeee0}

/* hero */
.hero{margin:0 0 12px;border-radius:18px;overflow:hidden;box-shadow:0 10px 18px rgba(0,0,0,.08)}
.hero video,.hero img{display:block;width:100%;height:auto}

/* promo interstitials */
.promo-hero{margin:0;border-radius:16px;overflow:hidden;box-shadow:0 10px 22px rgba(0,0,0,.06)}
.promo-hero img{display:block;width:100%;height:auto}
</style>
</head>
<body>
<div class="app"><div class="card">
  <!-- Скидка в шапке (появляется со 2-го экрана) -->
  <div id="progress" class="hide">
    <div class="discbox">
      <span class="title">Ваша скидка</span>
      <span class="value" id="discVal">0%</span>
      <span class="disc-tip">i<span class="tt">Растёт с каждым вопросом!</span></span>
    </div>
    <div style="margin-left:auto"><img src="logo.png" alt="ШАГАЙ ДОМА" style="height:32px"></div>
  </div>

  <div id="screens"></div>
</div></div>

<script>
/* helpers */
const $=s=>document.querySelector(s), $$=(s,r)=>Array.from((r||document).querySelectorAll(s));
let A=JSON.parse(localStorage.getItem('sdq')||'{}'); const save=()=>localStorage.setItem('sdq',JSON.stringify(A));

/* screens builder */
const S=$("#screens");
const section=(id,html)=>`<section class="screen${id==='intro'?' is':''}" data-id="${id}">${html}</section>`;
const opts=(id,arr)=>`<div class="grid cols2" id="${id}">${arr.map(v=>`<label class="opt" data-v="${v}">${v}</label>`).join('')}</div>`;
const chips=(id,arr)=>`<div class="chips" id="${id}">${arr.map(v=>`<button type="button" class="chip" data-v="${v}">${v}</button>`).join('')}</div>`;
const actions=()=>`<div class="actions sticky"><button class="btn ghost" data-prev type="button">Назад</button><button class="btn primary" data-next type="button">Далее</button></div>`;

/* flow HTML */
const html =
section('intro',`
  <figure class="hero"><video autoplay muted playsinline loop preload="metadata" poster="logo.png"><source src="intro.mp4#t=0.1" type="video/mp4"></video></figure>
  <h1><b>Пройдите квиз, чтобы узнать получится ли у вас похудеть на шагах</b></h1>
  <p class="hint"><b>…а также получить бесплатную пробную тренировку и скидку 70% на наши абонементы!</b></p>
  <div class="grid"><div><div class="hint">Как к вам обращаться?</div><input id="name" class="text" placeholder="Например: Ирина"></div></div>
  <div class="actions sticky"><button class="btn primary" id="start" type="button">Поехали →</button></div>
`)
+section('age',`<h2>Ваш возраст</h2>${opts('ageOpts',['18–29','30–39','40–49','50+'])}${actions()}`)
+section('promo1',`
  <figure class="promo-hero"><img src="2.jpg" alt="Больше 1 млн подписчиков"></figure>
  <h2>У ШАГАЙ ДОМА⚡ уже больше <b>1&nbsp;миллиона</b> подписчика во всех соцсетях!</h2>
  <p class="hint">Присоединяйтесь к самому дружелюбному фитнес-сообществу.</p>
  ${actions()}
`)
+section('body',`
  <h2>Телосложение сейчас</h2>
  <div class="grid cols2" id="bodyOpts">
    ${[{k:'slim',t:'Худощавое',img:'skinny.png'},{k:'avg',t:'Среднее',img:'slim.png'},{k:'large',t:'Крупное',img:'medium.png'},{k:'obese',t:'Избыточный вес',img:'xl.png'}].map(o=>`<label class="opt opt--img" data-v="${o.k}"><img src="${o.img}" alt=""><span>${o.t}</span></label>`).join('')}
  </div>
  ${actions()}
`)
+section('promo2',`
  <figure class="promo-hero"><img src="otzyv.jpg" alt="Уже больше 10 000 людей в клубе"></figure>
  <h2>Уже больше <b>10&nbsp;000</b> людей в клубе ШАГАЙ ДОМА ⚡</h2>
  <p class="hint">Каждый на своём уровне, но вместе — сильнее.</p>
  ${actions()}
`)
+section('steps',`
  <h2>Сколько шагов вы проходите сейчас в день?</h2>
  <input id="steps" type="range" min="0" max="25000" step="250" value="4000">
  <div class="hint">Сейчас: <b><span id="sv">4000</span> шагов</b></div>
  ${actions()}
`)
+section('bmi',`
  <h2>Давайте посчитаем ваш ИМТ</h2>
  <div class="grid cols2">
    <div><div class="hint">Рост, см</div><input id="h" type="number" class="text"></div>
    <div><div class="hint">Вес, кг</div><input id="w" type="number" class="text"></div>
  </div>
  <div id="bmiI" class="hint"></div>
  ${actions()}
`)
+section('life',`<h2>Образ жизни</h2>${opts('lifeOpts',['Сидячая работа','Умеренно активная','Активная'])}${actions()}`)
+section('exp',`<h2>Опыт тренировок</h2>${opts('expOpts',['Никогда не занималась','Иногда дома / по видео','Регулярно'])}${actions()}`)
+section('promo3',`
  <figure class="promo-hero"><img src="walkwalk.jpg" alt="20 млн шагов в день"></figure>
  <h2><b>20&nbsp;миллионов</b> шагов каждый день набирают участницы клуба 😍</h2>
  <p class="hint">Короткие шагательные тренировки легко вписать в день.</p>
  ${actions()}
`)
+section('goal',`
  <h2>Ваша цель</h2>
  <div class="grid cols2">
    <div>
      <label><input id="goalKeep" type="checkbox"> <b>Накачать мышцы / поддерживать форму</b></label>
      <div class="hint" style="margin:6px 0">Если цель — не худеть, отметьте этот пункт.</div>
      <div style="margin:10px 0"><span>Скинуть (кг): </span><input id="goalRange" type="range" min="0" max="20" step="0.5" value="5"><b> <span id="goalVal">5.0</span> кг</b></div>
      <div class="hint">Сложность цели: <span id="goalBadge" class="goal-badge goal-mid">умеренно</span></div>
    </div>
    <div class="hint">Цель можно корректировать в процессе — расчёт подстроится.</div>
  </div>
  ${actions()}
`)
+section('perweek',`
  <h2>Сколько готовы тренироваться в неделю?</h2>
  ${chips('pwChips',['2 раза','3 раза','4–5 раз','Каждый день 20–30 мин'])}
  <div id="aha" class="hidden" style="margin-top:8px"></div>
  <figure id="chartFig" class="hidden" style="margin:6px 0 0"><img src="chart.jpg" alt="Пример прогресса"></figure>
  ${actions()}
`)
+section('promo4',`
  <figure class="promo-hero"><img src="doposle.jpg" alt="85% похудели на 1–2 кг"></figure>
  <h2><b>85%</b> клубников похудели на <b>1–2&nbsp;кг</b> за первую неделю тренировок 🔥</h2>
  <p class="hint">Результат мотивирует продолжать.</p>
  ${actions()}
`)
+section('hard',`
  <h2>Что сейчас даётся тяжелее всего?</h2>
  <div class="grid cols2" id="hardCards">
    <div class="hcard" data-k="walk"><div class="hhead"><div class="hicon">🚶‍♀️</div><div>Долгая прогулка утомляет</div></div></div>
    <div class="hcard" data-k="stairs"><div class="hhead"><div class="hicon">🪜</div><div>Лестницы — испытание</div></div></div>
    <div class="hcard" data-k="games"><div class="hhead"><div class="hicon">🎯</div><div>Активные игры</div></div></div>
    <div class="hcard" data-k="jumps"><div class="hhead"><div class="hicon">🦘</div><div>Прыжки</div></div></div>
    <div class="hcard" data-k="none"><div class="hhead"><div class="hicon">✅</div><div>Ничего из этого</div></div></div>
  </div>
  ${actions()}
`)
+section('health',`<h2>Есть ли состояния, которые важно учитывать?</h2>${chips('healthChips',['Диабет','Проблемы со щитовидкой','Гипертония','Боль в суставах','Беременность','Нет'])}${actions()}`)
+section('nutrition',`<h2>Питание</h2>${opts('nutriOpts',['Буду питаться по меню-конструктору в клубе','Хочу научиться правильно составлять тарелку','Нет, пока без питания'])}${actions()}`)
+section('food',`
  <h2>Ваши привычки</h2>
  <div class="chips" id="bad">${['Сладкие перекусы','Полуфабрикаты','Недосып','Частый стресс'].map(x=>`<button class="chip" data-kind="bad" data-v="${x}">${x}</button>`).join('')}</div>
  <div class="chips" id="good" style="margin-top:8px">${['1.5–2 л воды','Овощи 400 г/день','Белок и фрукты в каждом приёме пищи','Сон 7-8 часов'].map(x=>`<button class="chip" data-kind="good" data-v="${x}">${x}</button>`).join('')}</div>
  <div class="habit-meter hidden" id="hmWrap" style="margin-top:10px">
    <div style="display:flex;justify-content:space-between"><div>Индекс прогресса <span id="hmBadge" class="hm-badge">нейтрально</span></div><b id="hmScore">0%</b></div>
    <div class="hm-track" id="hmTrack"><div class="hm-pointer" id="hmPtr"></div></div>
  </div>
  <div class="actions sticky"><button class="btn ghost" data-prev type="button">Назад</button><button class="btn primary" id="toTrial" type="button">Далее →</button></div>
`)
+section('trial',`
  <h2>Ура! Вы ответили на все вопросы 🎉</h2>
  <p class="hint"><b>Теперь вам доступна пробная тренировка.</b></p>
  <div class="p-tabs" id="trialTabs"></div>
  <figure style="aspect-ratio:16/9;border-radius:16px;overflow:hidden"><div id="trialFrame" class="player"></div></figure>
  <p class="hint"><b id="trialCtaText">Узнайте, на сколько вы похудеете, если будете заниматься по таким тренировкам 3 раза в неделю.</b></p>
  <div class="actions sticky"><button class="btn ghost" data-prev type="button">Назад</button><button class="btn primary" id="calc" type="button">Узнать мой прогноз →</button></div>
`)
+section('loading',`
  <div style="text-align:center;padding:34px 0"><div id="lp" style="display:inline-grid;place-items:center;width:96px;height:96px;border-radius:50%;background:conic-gradient(var(--o) 0deg,#eee 0deg)"><div style="width:70px;height:70px;background:#fff;border-radius:50%;display:grid;place-items:center"><b id="lpct">0%</b></div></div><div style="margin-top:12px" id="lmsg">Собираем данные…</div></div>
`)
+section('result',`
  <h2 id="rTitle">Готово!</h2>
  <div style="font-size:clamp(24px,6vw,44px);font-weight:900;margin:6px 0" id="nums">0 кг за 0 недель</div>
  <p class="hint" id="rSub"></p>
  <div style="margin:10px 0">
    <p class="hint"><b>Только для вас у нас действует специальное предложение: −70% на все абонементы в клуб!</b></p>
    <div class="deal-row"><span class="deal-badge">Предложение ограничено</span><span class="deal-timer" id="inlineTimer">15:00</span></div>
    <div class="actions" style="margin-top:10px"><button class="btn primary" id="toOffer" type="button">Перейти к предложению!</button></div>
  </div>
  <div class="actions"><button class="btn ghost" data-prev type="button">Назад</button><button class="btn primary" id="seeProgram" type="button">Посмотреть программу</button></div>
`)
+section('progSelect',`
  <h2>Подберём программу под вас</h2>
  <p class="hint">Мы учли ваш возраст, ИМТ, активность, опыт и цель. Можно выбрать другой вариант.</p>
  <div class="pgrid" id="progGrid"></div>
  <div class="actions sticky"><button class="btn ghost" data-prev type="button">Назад</button><button class="btn primary" id="goProgram" type="button">Смотреть неделю →</button></div>
`)
+section('program',`
  <h2 id="progTitle">Пример вашей недели в клубе</h2>
  <p class="hint" id="progLead"></p>
  <div class="week-grid" id="weekGrid"></div>
  <div class="actions sticky"><button class="btn ghost" data-prev type="button">Назад</button><button class="btn primary" id="progToOffer" type="button">Перейти к предложению!</button></div>
`)
+section('sale',`
  <h2>Присоединяйтесь к клубу «ШАГАЙ ДОМА» ⚡</h2>
  <p class="hint" id="sLead"></p>
  <p class="hint"><b>Только для вас у нас действует специальное предложение: −70% на все абонементы в клуб!</b></p>
  <div class="deal-row"><span class="deal-badge">Предложение ограничено</span><span class="deal-timer" id="saleTimer">15:00</span></div>
  <div class="actions" style="margin-top:10px"><a class="btn primary" id="cta" target="_blank" rel="noopener" href="https://walk-walk.ru/?utm_source=website&utm_medium=quiz&utm_campaign=looseweight">Хочу абонемент со скидкой 70%!</a></div>
`);

S.innerHTML = html;

/* progress header (увеличиваем скидку только от вопросов) */
let idx=0, SECTIONS=$$('.screen');
const progress=$('#progress'), discVal=$('#discVal');
const QUESTION_IDS=['age','body','steps','bmi','life','exp','goal','perweek','hard','health','nutrition','food'];
function idxBy(id){return SECTIONS.findIndex(s=>s.dataset.id===id)}
function updateDiscount(){
  let seen=0;
  for(const id of QUESTION_IDS){
    const qi=idxBy(id); if(qi>=0 && idx>=qi) seen++;
  }
  const pct=Math.min(70,Math.round(seen/QUESTION_IDS.length*70));
  discVal.textContent=pct+'%';
}
function show(n){
  SECTIONS[idx].classList.remove('is');
  idx=Math.max(0,Math.min(SECTIONS.length-1,n));
  SECTIONS[idx].classList.add('is');
  progress.classList.toggle('hide',idx===0);
  updateDiscount();
  window.scrollTo({top:0,behavior:'smooth'});
  const id=SECTIONS[idx].dataset.id;
  if(id==='trial') mountTrial();
  if(id==='progSelect') renderProgSelect();
  if(id==='program') renderProgram();
}

/* navigation */
$('#start').onclick=()=>show(1);
window.addEventListener('click',e=>{
  if(e.target.closest('[data-next]')) show(idx+1);
  if(e.target.closest('[data-prev]')) show(idx-1);
});
$('#toTrial').onclick=()=>show(idxBy('trial'));
$('#calc').onclick=()=>{show(idxBy('loading')); runLoading(calculate);};
$('#toOffer').onclick=()=>show(idxBy('sale'));
$('#seeProgram').onclick=()=>show(idxBy('progSelect'));
$('#goProgram').onclick=()=>show(idxBy('program'));
$('#progToOffer').onclick=()=>show(idxBy('sale'));

/* inputs */
$('#name').oninput=e=>{A.name=e.target.value.trim();save()};
const steps=$('#steps'), sv=$('#sv'); const updR=()=>{const min=+steps.min,max=+steps.max,val=+steps.value;steps.style.setProperty('--pct',((val-min)/(max-min))*100+'%')};
steps.oninput=e=>{A.steps=+e.target.value;sv.textContent=A.steps;updR();save();updateAha()}; updR();
['h','w'].forEach(id=>{$('#'+id).addEventListener('input',updBMI)});
function updBMI(){const h=+$('#h').value,w=+$('#w').value;if(h>0&&w>0){A.h=h;A.w=w;const m=h/100;A.bmi=+(w/(m*m)).toFixed(1);save();$('#bmiI').innerHTML='Ваш ИМТ: <b>'+A.bmi+'</b>'}else{$('#bmiI').textContent=''}}

/* selectors */
function choose(root,key,single){root.addEventListener('click',e=>{const el=e.target.closest(single?'.opt':'.chip');if(!el)return;
  if(single){$$('.opt',root).forEach(x=>x.classList.remove('is'));el.classList.add('is');A[key]=el.dataset.v||el.textContent}
  else{el.classList.toggle('is');A[key]=$$('.chip.is',root).map(x=>x.dataset.v)}
  save(); if(key==='perweek') updateAha();
});}
choose($('#ageOpts'),'age',true);
choose($('#bodyOpts'),'body',true);
choose($('#lifeOpts'),'life',true);
choose($('#expOpts'),'exp',true);
choose($('#pwChips'),'perweek',false);
choose($('#healthChips'),'health',false);
choose($('#nutriOpts'),'nutri',true);

/* HARD question (fixed + restore) */
(function(){
  const wrap=$('#hardCards'); const map={walk:'Долгая прогулка утомляет',stairs:'Лестницы — испытание',games:'Активные игры',jumps:'Прыжки',none:'Ничего из этого'};
  if(A.hardKey){const sel=wrap.querySelector(`[data-k="${A.hardKey}"]`); if(sel) sel.classList.add('is')}
  wrap.addEventListener('click',e=>{
    const c=e.target.closest('.hcard'); if(!c) return;
    $$('.hcard',wrap).forEach(x=>x.classList.remove('is'));
    c.classList.add('is'); A.hardKey=c.dataset.k; A.hard=map[A.hardKey]; save();
  });
})();

/* goal */
const goalR=$('#goalRange'), goalV=$('#goalVal'), goalB=$('#goalBadge'), goalKeep=$('#goalKeep');
function setGoal(v){v=Math.max(0,Math.min(20,+v||0));A.goalKg=v;goalV.textContent=v.toFixed(1);const cls=v===0?'goal-soft':v<=10?'goal-mid':'goal-hard';const txt=v===0?'поддержание':v<=10?'умеренно':'интенсивно';goalB.className='goal-badge '+cls;goalB.textContent=txt;save()}
goalR.oninput=e=>setGoal(e.target.value);
goalKeep.onchange=e=>{A.keep=!!e.target.checked;save();if(A.keep){setGoal(0);goalR.disabled=true}else{goalR.disabled=false;if((+A.goalKg||0)===0)setGoal(5)}};
(function(){const kg=(A.goalKg!=null)?A.goalKg:5;goalR.value=kg;setGoal(kg);goalKeep.checked=!!A.keep;goalR.disabled=!!A.keep})();

/* perweek & chart reveal */
function freqFromPerweek(){const s=A.perweek||[];let n=0;if(s.some(v=>/Каждый день/.test(v)))n=7;else if(s.some(v=>/4–5/.test(v)))n=5;else if(s.some(v=>/3/.test(v)))n=3;else if(s.some(v=>/2/.test(v)))n=2;return n}
function perweekLabel(){const s=freqFromPerweek();return s===7?'каждый день':s===5?'4–5 раз в неделю':s===3?'3 раза в неделю':s===2?'2 раза в неделю':'3 раза в неделю'}
function updateAha(){const n=freqFromPerweek(), box=$('#aha'), fig=$('#chartFig'); if(!n){box.classList.add('hidden');box.innerHTML='';fig.classList.add('hidden');return}
 const add=n*3000, base=(+A.steps||4000)*7, k=base?Math.min(2.5,Math.max(1.1,(base+add)/base)):1.3;
 box.innerHTML='<b>Отлично!</b> С тренировками '+(n===7?'каждый день':'~'+n+' раза в неделю')+' активность вырастет примерно в <b>'+k.toFixed(1)+' раза</b> (ещё ~'+add.toLocaleString('ru-RU')+' шагов/нед).';
 box.classList.remove('hidden'); fig.classList.remove('hidden');
}

/* trial player (VK/YouTube/RuTube) */
const EMBEDS={vk:'https://vk.com/video_ext.php?oid=-222534261&id=456239990&hd=2',yt:'https://www.youtube-nocookie.com/embed/TFltKZJoV2g?rel=0&modestbranding=1',rt:'https://rutube.ru/play/embed/fbad797705787d6048d2344b7aa55a90?r=a&p=93p6xGkyvbtXxF38SzuoSw'};
function mountTrial(){
  const tabs=$('#trialTabs'), frame=$('#trialFrame');
  tabs.innerHTML=['vk','yt','rt'].map((k,i)=>`<button class="p-btn${i?'':' is'}" data-k="${k}">${{vk:'VK Видео',yt:'YouTube',rt:'RuTube'}[k]}</button>`).join('');
  function sel(k){tabs.querySelectorAll('.p-btn').forEach(b=>b.classList.toggle('is',b.dataset.k===k));frame.innerHTML=`<iframe src="${EMBEDS[k]}" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>`}
  tabs.onclick=e=>{const b=e.target.closest('.p-btn'); if(b) sel(b.dataset.k)};
  sel('vk');
  $('#trialCtaText').innerHTML = `<b>Узнайте, на сколько вы похудеете, если будете заниматься по таким тренировкам ${perweekLabel()}.</b>`;
}

/* loading */
function runLoading(done){
  const lp=$('#lp'),pct=$('#lpct'),msg=$('#lmsg');const T=1500,t0=performance.now();
  const steps=['Возраст и ИМТ','Активность и опыт','Цель и питание','Готовим прогноз…'];
  requestAnimationFrame(function tick(t){const p=Math.min(1,(t-t0)/T);pct.textContent=Math.round(5+95*(1-Math.pow(1-p,3)))+'%';msg.textContent=steps[Math.min(steps.length-1,Math.floor(p*steps.length))];lp.style.background=`conic-gradient(var(--o) ${Math.round(p*360)}deg,#eee 0)`;if(p<1)requestAnimationFrame(tick);else setTimeout(done,200)})
}

/* расчёт */
function fLife(){return /Активная/.test(A.life||'')?1.08:/Сидячая/.test(A.life||'')?0.9:1.0}
function fExp(){return /Регулярно/.test(A.exp||'')?1.08:/Никогда/.test(A.exp||'')?0.95:1.0}
function fBody(){return {slim:.92,avg:1,large:.96,obese:.92}[A.body||'avg']||1}
function fSteps(){const now=+A.steps||4000;let b=1+2000/10000;if(now<3000)b+=.08;if(now>9000)b-=.06;return Math.max(.95,Math.min(1.28,b))}
function rate(){let r=.5;const bmi=A.bmi||26;if(bmi>=30)r+=.08;else if(bmi<23)r-=.08;r*=fLife()*fExp()*fBody()*fSteps();return Math.max(.25,Math.min(.9,+r.toFixed(2)))}
function fmtDur(w){return w<=10?{v:w,u:'недель'}:{v:Math.ceil(w/4),u:'мес.'}}
function goalKg(){if(A.keep)return 0;return A.goalKg!=null?+A.goalKg:5}
function calculate(){
  const name=A.name?.trim()||'Друзья'; const keep=!!A.keep; const kg=goalKg(); const r=rate(); const w=Math.max(4,Math.min(16,Math.ceil((keep?4:kg)/r))); const d=fmtDur(w);
  $('#rTitle').textContent=`${name}, ваш прогноз готов ✨`;
  if(keep||kg===0){$('#nums').textContent=`Чтобы прийти к цели за ${d.v} ${d.u}`;$('#rSub').innerHTML=`Сфокусируемся на <b>тонусе и выносливости</b>.`;}
  else{$('#nums').textContent=`−${kg} кг за ${d.v} ${d.u}`;$('#rSub').innerHTML=`С ШАГАЙ ДОМА ⚡ вы будете проходить <b>${(+A.steps+2000).toLocaleString('ru-RU')}</b> шагов в день.`;}
  startTimers();
  A.recKeys = chooseProgramKeys(); save();
  $('#sLead').innerHTML = keep? 'Готовые планы на тонус и мышцы, поддержка и сообщество помогут вам держать ритм.' : `Чтобы прийти к цели <b>−${kg} кг</b> — подключите готовые планы и поддержку.`;
  show(idxBy('result'));
}

/* таймеры 15 минут (общий дедлайн) */
function getDeadline(){let t=+localStorage.getItem('sdq_offer_deadline15')||0;const now=Date.now();if(!t||t<now){t=now+15*60*1000;localStorage.setItem('sdq_offer_deadline15',String(t))}return t}
function fmt(ms){let s=Math.max(0,Math.floor(ms/1000)),m=Math.floor(s/60);s%=60;return String(m).padStart(2,'0')+':'+String(s).padStart(2,'0')}
let timerI=null;function startTimers(){if(timerI)clearInterval(timerI);const dl=getDeadline();const t1=$('#inlineTimer'),t2=$('#saleTimer');function tick(){const left=dl-Date.now();const v=fmt(left);t1&&(t1.textContent=v);t2&&(t2.textContent=v);if(left<=0)clearInterval(timerI)}tick();timerI=setInterval(tick,1000)}

/* ====== КАТАЛОГ ПРОГРАММ (из вашего описания) ====== */
const CATALOG={
  /* ШАГАЙ И ТАНЦУЙ */
  dance_grace:{title:'Раскрываем женственность',cat:'Шагай и танцуй',desc:'Танцевальные связки, пластика и грация.',workouts:9,duration:'15–45 мин',steps:'2000–3000',tempo:'средний',type:'dance',freq:3},
  dance_learn:{title:'Учимся танцевать',cat:'Шагай и танцуй',desc:'Выучите танцевальные связки и набирайте шаги.',workouts:4,duration:'25–30 мин',steps:'2000–3000',tempo:'средний',type:'dance',freq:3},
  dance_mix:{title:'Шагай и танцуй',cat:'Шагай и танцуй',desc:'Шагательные тренировки с элементами танца.',workouts:6,duration:'5–40 мин',steps:'1000–4000',tempo:'низкий–средний',type:'dance',freq:3},
  dance_fitness:{title:'Танцевальный фитнес',cat:'Шагай и танцуй',desc:'Эстетика танца + нагрузка на всё тело.',workouts:12,duration:'20–50 мин',steps:'3000–4000',tempo:'средний',type:'dance',freq:4},
  zumba:{title:'Зумбавидные тренировки',cat:'Шагай и танцуй',desc:'Фитнес-вечеринка с пользой для фигуры.',workouts:7,duration:'20–60 мин',steps:'3000–6000',tempo:'высокий',type:'dance',freq:4},

  /* ШАГАТЕЛЬНЫЙ ФИТНЕС */
  abs_flat:{title:'Плоский живот',cat:'Шагательный фитнес',desc:'Шаги + упражнения на пресс.',workouts:6,duration:'15–25 мин',steps:'1000–2000',tempo:'высокий',type:'fitness',freq:4},
  strong_body:{title:'Сильное и рельефное тело',cat:'Шагательный фитнес',desc:'Силовые повышенной сложности.',workouts:8,duration:'15–25 мин',steps:'1000–2500',tempo:'высокий',type:'fitness',freq:4},
  glutes_legs:{title:'Красивые ягодицы и стройные ноги',cat:'Шагательный фитнес',desc:'Силовая проработка ног и ягодиц.',workouts:8,duration:'15–40 мин',steps:'1000–4000',tempo:'высокий',type:'fitness',freq:4},
  taebo:{title:'В стиле тай-бо',cat:'Шагательный фитнес',desc:'Движения в стиле бокса/кикбоксинга.',workouts:12,duration:'10–25 мин',steps:'1000–2000',tempo:'средний',type:'fitness',freq:5},
  lymph:{title:'Лимфодренажные тренировки',cat:'Шагательный фитнес',desc:'Избавиться от отёков и тяжести.',workouts:10,duration:'15–30 мин',steps:'~2000',tempo:'средний',type:'fitness',freq:3},
  tabata:{title:'Шагательная табата',cat:'Шагательный фитнес',desc:'Интервалы 20/10 для быстрого прогресса.',workouts:21,duration:'15–30 мин',steps:'1000–4000',tempo:'низкий–высокий',type:'fitness',freq:5},
  intervals:{title:'Интервальные тренировки',cat:'Шагательный фитнес',desc:'Снижение веса + выносливость.',workouts:6,duration:'25 мин',steps:'1000',tempo:'средний–высокий',type:'fitness',freq:4},

  /* ШАГАТЕЛЬНАЯ АЭРОБИКА */
  aero_active:{title:'ШАГАЙ ДОМА. Активно',cat:'Шагательная аэробика',desc:'Долгая активная ходьба без танцев.',workouts:7,duration:'15–40 мин',steps:'2000–6000',tempo:'высокий',type:'aero',freq:5},
  aero_base:{title:'ШАГАЙ ДОМА. База',cat:'Шагательная аэробика',desc:'Простой формат без разучивания движений.',workouts:8,duration:'15–20 мин',steps:'2000–2500',tempo:'низкий',type:'aero',freq:3},
  plus100:{title:'Тренировки для 100+ кг',cat:'Шагательная аэробика',desc:'Мягкие и небыстрые тренировки для старта.',workouts:7,duration:'15–20 мин',steps:'2000–2500',tempo:'низкий',type:'aero',freq:3},
  retro:{title:'Аэробика «Всё только начинается»',cat:'Шагательная аэробика',desc:'Ретро-стиль 80-х, динамика и стиль.',workouts:9,duration:'13–25 мин',steps:'2000–4000',tempo:'средний',type:'aero',freq:4},
  fifty:{title:'Тренировки для 50+',cat:'Шагательная аэробика',desc:'Бережная нагрузка, здоровье суставов.',workouts:7,duration:'15–20 мин',steps:'2000–2500',tempo:'средний',type:'aero',freq:3},

  /* КАРДИО ЗАРЯДКИ */
  hits:{title:'Шагай под хиты',cat:'Кардио зарядки',desc:'Короткие зарядки под любимые песни.',workouts:72,duration:'3–6 мин',steps:'200–600',tempo:'низкий',type:'cardio',freq:7},
  warmups:{title:'Кардио-разминки',cat:'Кардио зарядки',desc:'Бодрые мини-тренировки по 5 минут.',workouts:5,duration:'2–5 мин',steps:'200–600',tempo:'средний',type:'cardio',freq:5},

  /* ДРУГОЕ */
  stretch:{title:'Растяжки для здоровья',cat:'Другое',desc:'Гибкость, лёгкость и восстановление.',workouts:5,duration:'10–40 мин',steps:'—',tempo:'низк.–средн.',type:'other',freq:3},
  back:{title:'Здоровая спина',cat:'Другое',desc:'Укрепление спины и осанки.',workouts:12,duration:'15–20 мин',steps:'—',tempo:'низк.–средн.',type:'other',freq:3},
};
const ALL_KEYS=Object.keys(CATALOG);

/* выбор 4 программ под пользователя */
function chooseProgramKeys(){
  const age=A.age||'', exp=A.exp||'', life=A.life||'', bmi=+A.bmi||0, w=+A.w||0, steps=+A.steps||0, keep=!!A.keep, goal=+A.goalKg||0;
  const list=[]; const push=k=>{if(k && !list.includes(k)) list.push(k)};

  if(/50\+/.test(age)) push('fifty');
  if(bmi>=35 || w>=100){push('plus100'); push('aero_base');}
  if(keep || goal===0){push('strong_body'); push('glutes_legs'); push('dance_fitness'); push('stretch');}
  if(/Никогда/.test(exp)||/Сидячая/.test(life)||steps<4000){push('aero_base'); push('dance_mix');}
  if(/Регулярно/.test(exp) && (/Активная/.test(life)||steps>8000) && !keep && goal>=5){push('tabata'); push('intervals'); push('aero_active');}
  push('dance_grace');
  const fallback=['aero_active','taebo','abs_flat','zumba','back','warmups','lymph','retro','hits'];
  for(const k of fallback){ if(list.length>=4) break; push(k); }
  return list.slice(0,4);
}

/* рендер карточек выбора */
function renderProgSelect(){
  const grid=$('#progGrid'); const keys=A.recKeys || chooseProgramKeys(); A.recKeys=keys; save();
  const rec=keys[0];
  grid.innerHTML = keys.map(k=>{
    const p=CATALOG[k];
    return `<div class="pcard${k===rec?' is':''}" data-k="${k}">
      ${k===rec?'<div class="rec">Рекомендуем</div>':''}
      <span class="tag">${p.cat}</span>
      <h3>${p.title}</h3>
      <div class="meta">${p.desc}</div>
      <div class="meta" style="margin-top:6px">• Тренировок: <b>${p.workouts}</b> · Длительность: <b>${p.duration}</b><br>• Шагов за тренировку: <b>${p.steps}</b> · Темп: <b>${p.tempo}</b></div>
      <div class="actions" style="margin-top:8px"><button class="btn ghost" data-choose="${k}" type="button">Выбрать</button></div>
    </div>`;
  }).join('');
  grid.onclick=e=>{const b=e.target.closest('[data-choose]'); if(!b) return; const k=b.dataset.choose; A.progKey=k; save(); $$('.pcard',grid).forEach(c=>c.classList.toggle('is',c.dataset.k===k));};
  if(!A.progKey) A.progKey=rec;
}

/* неделя по выбранной программе */
function renderProgram(){
  const key=A.progKey || (A.recKeys?A.recKeys[0]:chooseProgramKeys()[0]); const p=CATALOG[key];
  $('#progTitle').textContent = `«${p.title}» — пример вашей недели`;
  const freq = freqFromPerweek() || p.freq || 3;
  $('#progLead').innerHTML = `${p.cat} • Рекомендуем тренироваться <b>${freq}</b> раз(а) в неделю · ${p.desc}`;
  const days=['Пн','Вт','Ср','Чт','Пт','Сб','Вс'];
  let trainIdx=[];
  if(freq===2) trainIdx=[1,4]; else if(freq===3) trainIdx=[0,2,5]; else if(freq===4) trainIdx=[0,2,4,6]; else if(freq===5) trainIdx=[0,1,3,5,6]; else trainIdx=[0,1,2,3,4,5];
  const grid=$('#weekGrid');
  const titleByType={dance:'Танцевальная шагательная',fitness:'Шаги + силовые',aero:'Аэробная ходьба',cardio:'Кардио-зарядка',other:'Восстановление'};
  const addByType={dance:'разбор/связки под музыку',fitness:'20–30 мин • корпус/ягодицы',aero:'длительная ходьба 20–40 мин',cardio:'5–10 мин бодрой активности',other:'растяжка/здоровая спина'};
  grid.innerHTML = days.map((d,i)=>{
    const train=trainIdx.includes(i);
    if(!train) return `<div class="day"><h4>${d}</h4><span class="badge badge-rest">Прогулка / отдых</span><div class="hint">5–8 тыс. шагов в удовольствие</div></div>`;
    return `<div class="day"><h4>${d}</h4><span class="badge badge-tr">${titleByType[p.type]}</span><div class="hint">${addByType[p.type]}</div></div>`;
  }).join('');
}

/* trial text refresh */
function updateTrialText(){const el=$('#trialCtaText'); if(el) el.innerHTML=`<b>Узнайте, на сколько вы похудеете, если будете заниматься по таким тренировкам ${perweekLabel()}.</b>`;}

/* loading progress ring → calc */
function animRingTo(pct){const lp=$('#lp');lp.style.background=`conic-gradient(var(--o) ${pct}deg,#eee 0)`}

/* init */
$('#start').focus();
startTimers();
</script>
</body>
</html>
