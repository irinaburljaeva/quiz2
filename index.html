<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ—Ç –®–ê–ì–ê–ô –î–û–ú–ê‚ö°</title>
<meta name="description" content="–£–∑–Ω–∞–π—Ç–µ, –∑–∞ —Å–∫–æ–ª—å–∫–æ –Ω–µ–¥–µ–ª—å —à–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ–º–æ–≥—É—Ç –≤–∞–º –ø–æ—Ö—É–¥–µ—Ç—å."/>
<meta name="color-scheme" content="light only"/>
<link rel="preload" as="image" href="superfit.png">
<link rel="preload" as="image" href="m.png">
<link rel="preload" as="image" href="xxl.png">
<style>
:root{
  --r:#CF2C02;--y:#FFBA08;--o:#E85D04;--g:#D9D9D9;--txt:#1a1a1a;
  --hero-pos-y:28%;--hero-pos-y-m:22%;
  --disc-bg:#fff7ef; --disc-fg:#a04000; --disc-win:#e9f9f0; --disc-win-fg:#0f7a42;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--txt);background:#fff;overflow-x:hidden}
.app{width:min(960px,100%);margin:0 auto;padding:16px}
.card{background:#fff;border-radius:22px;box-shadow:0 10px 30px rgba(0,0,0,.08);padding:16px;overflow:hidden;position:relative}

/* HERO */
.hero-wrap{position:relative;margin:0 0 12px;border-radius:20px;overflow:hidden;box-shadow:0 10px 18px rgba(0,0,0,.08)}
.hero-media{display:block;width:100%;height:auto;aspect-ratio:16/9;object-fit:cover;object-position:50% var(--hero-pos-y);border-radius:20px}
@media (max-width:480px){.hero-media{object-position:50% var(--hero-pos-y-m)}}
.hero-skel{position:absolute;inset:0;border-radius:20px;background:linear-gradient(110deg,#f4f4f4 8%,#eaeaea 18%,#f4f4f4 33%);background-size:200% 100%;animation:heroShimmer 1.2s linear infinite;pointer-events:none}
@keyframes heroShimmer{to{background-position-x:-200%}}
.hero-skel.hide{opacity:0;pointer-events:none;transition:opacity .25s ease}

/* Screens */
.screen{display:none;animation:.35s fs ease both;padding-bottom:90px}
.screen.is{display:block}
@keyframes fs{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
h1{font-size:clamp(22px,5.6vw,38px);line-height:1.15;margin:8px 0 10px}
h2{font-size:clamp(20px,5vw,30px);line-height:1.18;margin:6px 0 12px}
.hint{color:#6b6b6b;font-size:.95rem}
.grid{display:grid;gap:10px}.cols2{grid-template-columns:1fr 1fr}
@media (max-width:620px){.cols2{grid-template-columns:1fr}}

.opt{border:2px solid var(--g);border-radius:14px;padding:12px;display:flex;gap:10px;align-items:center;background:#fff;cursor:pointer;transition:.2s}
.opt.is{border-color:var(--o);box-shadow:0 6px 16px rgba(232,93,4,.12)}
.opt--img{flex-direction:column;align-items:center;text-align:center;padding:10px}
.opt--img img{width:100%;height:180px;object-fit:contain;background:#fafafa;border-radius:12px}
.opt--img span{margin-top:8px;font-weight:600}

.chips{display:flex;flex-wrap:wrap;gap:8px}
.chip{border:2px solid var(--g);border-radius:999px;padding:8px 12px;background:#fff;cursor:pointer}
.chip.is{border-color:var(--o);box-shadow:0 6px 16px rgba(232,93,4,.12)}
.text{width:100%;border:2px solid var(--g);border-radius:12px;padding:10px 12px;font-size:1rem}

.actions{display:flex;gap:8px;margin-top:14px}
.btn{border:none;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer}
.primary{background:linear-gradient(135deg,var(--r),var(--o));color:#fff;box-shadow:0 10px 18px rgba(207,44,2,.25)}
.ghost{background:#fff;border:2px solid var(--g)}
.sticky{position:sticky;bottom:0;background:linear-gradient(0deg,#fff 70%,rgba(255,255,255,0));padding-top:8px;z-index:20}

/* Top bar: progress + logo + discount */
#progress{position:relative;height:auto;margin:0 0 12px;display:flex;align-items:center;gap:10px;flex-wrap:wrap}
#progress.hide{display:none!important}
#progress .pcirc{--p:0%;width:56px;height:56px;border-radius:50%;background:conic-gradient(var(--o) var(--p),#eee 0);position:relative;display:inline-grid;place-items:center;box-shadow:0 6px 16px rgba(0,0,0,.08);transition:background .15s linear;flex:0 0 56px}
#progress .pcirc::after{content:"";width:44px;height:44px;border-radius:50%;background:#fff;position:absolute}
#progress .pct{position:relative;z-index:1;font-size:.9rem;font-weight:800;letter-spacing:-.02em}
#progress .plogo{margin-left:auto;display:flex;align-items:center;flex:0 0 auto}
#progress .plogo img{height:32px;width:auto;display:block;object-fit:contain}
@media (max-width:480px){#progress .plogo img{height:28px}}

#disc{display:none;align-items:center;gap:8px;border:2px solid #ffd5c2;background:var(--disc-bg);color:var(--disc-fg);border-radius:12px;padding:8px 12px;font-weight:800}
#disc.win{background:var(--disc-win);color:var(--disc-win-fg);border-color:#cfeede}
#disc .tooltip{font-weight:600;color:#555;font-size:.9rem}
#disc .i{font-weight:900}

/* Steps slider */
#steps{--pct:0%;--track:#e9e9e9;--fill-start:var(--r);--fill-end:var(--o);width:100%;height:40px;background:transparent;accent-color:var(--o)}
#steps:focus{outline:none}
#steps::-webkit-slider-runnable-track{height:12px;border-radius:999px;background:linear-gradient(90deg,var(--fill-start) 0 var(--pct),var(--track) var(--pct) 100%);box-shadow:inset 0 1px 2px rgba(0,0,0,.08)}
#steps::-webkit-slider-thumb{-webkit-appearance:none;width:28px;height:28px;border-radius:50%;background:#fff;border:3px solid var(--o);box-shadow:0 4px 10px rgba(232,93,4,.25);margin-top:-8px;transition:transform .12s ease}
#steps:active::-webkit-slider-thumb{transform:scale(1.06)}
#steps::-moz-range-track{height:12px;border-radius:999px;background:#e9e9e9}
#steps::-moz-range-progress{height:12px;border-radius:999px;background:linear-gradient(135deg,var(--fill-start),var(--end))}
#steps::-moz-range-thumb{width:28px;height:28px;border-radius:50%;background:#fff;border:3px solid var(--o);box-shadow:0 4px 10px rgba(232,93,4,.25)}

/* BMI */
.bmi-line{margin-top:6px}
.bmi-tag{display:inline-block;padding:4px 8px;border-radius:999px;font-weight:700;font-size:.9rem;vertical-align:baseline}
.bmi-ok{background:#e8f7ee;color:#0f7a42}.bmi-warn{background:#fff4e6;color:#a04b00}.bmi-bad{background:#ffe9e6;color:#a11000}

/* Habits */
.habit{display:grid;gap:14px}
.habit-grid{display:grid;gap:12px;grid-template-columns:1fr 1fr}
@media (max-width:720px){.habit-grid{grid-template-columns:1fr}}
.habit h3{margin:.2rem 0 .6rem;font-size:1.02rem}
.habit .col{border:2px solid var(--g);border-radius:14px;padding:12px;background:#fff}
.chips--pills{gap:8px}
.chips--pills .chip{border-radius:999px;padding:9px 12px;font-weight:600;border:2px solid var(--g);background:#fff;transition:.15s}
.chips--pills .chip.is{border-color:var(--o);background:#fffaf5}

.habit-meter{border:2px solid var(--g);border-radius:14px;padding:12px;background:#fff}
.habit-meter.hidden{display:none}
.hm-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
#hmScore{font-weight:800}
.hm-track{--p:50%;position:relative;height:12px;border-radius:999px;overflow:hidden;background:linear-gradient(90deg,#ffe1db 0%,#fff7e8 50%,#e7f7ef 100%)}
.hm-pointer{position:absolute;top:50%;left:var(--p);transform:translate(-50%,-50%);width:16px;height:16px;border-radius:50%;background:#fff;border:3px solid var(--o);box-shadow:0 3px 10px rgba(0,0,0,.12);transition:left .25s ease}
.hm-scale{display:flex;justify-content:space-between;font-size:.82rem;color:#666;margin-top:6px}
.hm-badge{display:inline-block;padding:4px 8px;border-radius:999px;font-weight:700;font-size:.85rem;margin-left:8px}
.hm-bad{background:#ffe9e6;color:#a11000}.hm-ok{background:#fff3cc;color:#9a6b00}.hm-good{background:#e7f7ef;color:#0f7a42}

/* Hard cards */
.hardw{display:grid;gap:14px}
.hard-cards{display:grid;gap:12px;grid-template-columns:1fr 1fr}
@media (max-width:760px){.hard-cards{grid-template-columns:1fr}}
.hcard{position:relative;border:2px solid var(--g);border-radius:16px;background:#fff;padding:14px;cursor:pointer;transform-style:preserve-3d;transition:transform .15s ease,box-shadow .2s ease,border-color .2s;box-shadow:0 8px 18px rgba(0,0,0,.05);overflow:hidden}
.hcard:hover{box-shadow:0 12px 26px rgba(0,0,0,.08)}
.hcard.is{border-color:var(--o);background:linear-gradient(180deg,#fff 0,#fff9f3 100%);box-shadow:0 12px 26px rgba(232,93,4,.18)}
.hhead{display:flex;gap:10px;align-items:center;letter-spacing:-.02em}
.hicon{width:44px;height:44px;border-radius:12px;display:grid;place-items:center;font-size:22px;background:#fff6f1;border:2px solid #ffd5c2}
.hhead,.hhead *{font-weight:500 !important}

/* Goal UI (–≤–∞—à–∞ –≤–µ—Ä—Å–∏—è) */
.goalw{display:grid;gap:12px}
.goal-top{display:grid;gap:8px;grid-template-columns:1.05fr .95fr}
@media (max-width:780px){.goal-top{grid-template-columns:1fr}}
.goal-card{border:2px solid var(--g);border-radius:16px;padding:10px;background:#fff;overflow:hidden}
.goal-fig{position:relative;height:260px;border:2px solid var(--g);border-radius:16px;padding:8px;background:#fff;overflow:hidden}
@media (max-width:480px){.goal-fig{height:220px}}
.goal-range .val{display:flex;align-items:baseline;gap:8px;font-size:clamp(18px,4.6vw,28px);font-weight:800;letter-spacing:-.03em;white-space:nowrap}
.goal-range .sub{color:#666;margin-top:2px}
#goalRange{width:100%;height:38px;background:transparent;accent-color:var(--o);--track:#e9e9e9;--fill-start:var(--r);--fill-end:var(--o)}
#goalRange:focus{outline:none}
#goalRange::-webkit-slider-runnable-track{height:12px;border-radius:999px;background:linear-gradient(90deg,var(--fill-start) 0 var(--pct),var(--track) var(--pct) 100%)}
#goalRange::-webkit-slider-thumb{-webkit-appearance:none;width:26px;height:26px;border-radius:50%;background:#fff;border:3px solid var(--o);box-shadow:0 4px 12px rgba(232,93,4,.25);margin-top:-7px;transition:transform .12s ease}
#goalRange::-moz-range-thumb{width:26px;height:26px;border-radius:50%;background:#fff;border:3px solid var(--o)}
.goal-stack{position:relative;width:100%;height:100%}
.goal-stack img{position:absolute;inset:0;width:100%;height:100%;object-fit:contain;opacity:0;transform:scale(1);transition:opacity .28s ease,transform .28s ease;filter:drop-shadow(0 8px 22px rgba(0,0,0,.08))}
.goal-stack .tape{display:none!important}

/* Loading/result/sale */
.loader2{display:flex;flex-direction:column;align-items:center;text-align:center;padding:28px 8px 12px}
.loader2 .ring{--p:0%;width:88px;height:88px;border-radius:50%;background:conic-gradient(var(--o) var(--p),#eee 0);position:relative;box-shadow:0 8px 20px rgba(0,0,0,.08)}
.loader2 .ring::after{content:"";position:absolute;inset:10px;background:#fff;border-radius:50%}
.loader2 .pct{position:absolute;inset:0;display:grid;place-items:center;font-weight:800}
.loader2 .lmsg{margin-top:14px;font-weight:700;font-size:1.05rem}
.counter{font-size:clamp(26px,6vw,48px);line-height:1.15;letter-spacing:-.02em;text-wrap:balance}
.sale-hero{margin:0 0 12px;border-radius:16px;overflow:hidden}
.sale-hero img{width:100%;display:block;border-radius:16px;object-fit:cover}

/* –∫–µ–π—Å-–≤–∏–¥–∂–µ—Ç */
.case{border:2px solid var(--g);border-radius:16px;padding:12px;background:#fff;display:grid;grid-template-columns:96px 1fr;gap:12px;align-items:center;margin:10px 0}
.case img{width:96px;height:96px;object-fit:cover;border-radius:12px;background:#f6f6f6;cursor:zoom-in}
.case h3{margin:0 0 4px;font-size:1.05rem}
.case p{margin:0;color:#555}
.case.hide{display:none}

/* –ª–∞–π—Ç–±–æ–∫—Å */
#lightbox{position:fixed;inset:0;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center;z-index:9999;padding:20px}
#lightbox.show{display:flex}
#lightbox img{max-width:96vw;max-height:90vh;border-radius:14px;box-shadow:0 20px 60px rgba(0,0,0,.5)}
#lightbox .cap{color:#fff;margin-top:10px;text-align:center;font-size:1rem;opacity:.9}
#lightbox .x{position:absolute;top:10px;right:14px;width:40px;height:40px;border-radius:50%;display:grid;place-items:center;background:rgba(255,255,255,.12);color:#fff;font-size:26px;cursor:pointer}
#lightbox .x:active{transform:scale(.96)}

/* Program slide */
.prog-wrap{display:grid;gap:12px}
.prog-head{
  position:relative;border:2px solid var(--g);border-radius:16px;padding:14px 12px;
  background:
    radial-gradient(120% 80% at 0% 0%, rgba(255,240,230,.9), transparent 50%),
    radial-gradient(120% 80% at 100% 100%, rgba(255,247,236,.9), transparent 55%),
    linear-gradient(180deg,#fff,#fff);
  overflow:hidden;
}
.prog-head::after{
  content:""; position:absolute; right:-40px; top:-40px; width:160px; height:160px;
  background:conic-gradient(from 0deg, #FFBA08, #E85D04); opacity:.15; border-radius:50%;
  filter:blur(6px);
}
.p-title{margin:.2rem 0 6px; font-size:clamp(20px,5vw,28px); font-weight:800; letter-spacing:-.02em}
.p-sub{margin:0; color:#555}
.p-chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
.p-chip{border:2px solid #ffd5c2; background:#fff7ef; border-radius:999px; padding:6px 10px; font-weight:700; font-size:.88rem}
.p-chip.emph{border-color:#cfeede; background:#e9f9f0}
.prog-hero{margin:0 0 6px; border-radius:16px; overflow:hidden}
.prog-hero img{width:100%; display:block; border-radius:16px; object-fit:cover; box-shadow:0 12px 28px rgba(0,0,0,.08)}
.prog-card{border:0; border-radius:0; padding:0; background:transparent; box-shadow:none}
.prog-card h3{margin:.2rem 0 .6rem}
.prog-list{padding-left:18px; margin:.2rem 0}

/* Aha moment (–ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –≤ perweek) */
.aha{margin-top:8px;border-radius:16px;padding:12px;background:linear-gradient(180deg,#fff8f2,#fff);box-shadow:0 6px 20px rgba(232,93,4,.08)}
.aha.hidden{display:none}
.aha strong{font-weight:800}
.aha small{color:#666}
.aha img{width:100%;display:block;border-radius:12px;margin-top:8px;box-shadow:0 8px 22px rgba(0,0,0,.08)}

/* Limited-time deal styles */
.deal{margin:8px 0 12px}
.deal-row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.deal-badge{border:2px solid #ffd5c2;background:#fff7ef;border-radius:999px;padding:6px 10px;font-weight:800}
.deal-timer{margin-left:auto;font-weight:800;font-size:1.1rem;letter-spacing:.02em}
.offer-inline{border:2px solid var(--g);border-radius:16px;padding:12px;background:#fff;margin:10px 0}

/* Promo interstitials */
.promo{display:grid;gap:10px}
.promo-hero{margin:0;border-radius:16px;overflow:hidden;box-shadow:0 10px 22px rgba(0,0,0,.06)}
.promo-hero img,.promo-hero video{width:100%;display:block;border-radius:16px;object-fit:cover}

/* –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É" –≤ –∏–Ω–ª–∞–π–Ω-–æ—Ñ—Ñ–µ—Ä–µ —ç–∫—Ä–∞–Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ */
section[data-id="result"] #offerInline .actions { display:none !important; }

/* Trial tabs */
.tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
.tab{border:2px solid var(--g);background:#fff;border-radius:999px;padding:8px 12px;cursor:pointer;font-weight:700}
.tab.is{border-color:var(--o);box-shadow:0 6px 16px rgba(232,93,4,.12)}
.player{margin-top:10px}
.player iframe{width:100%;aspect-ratio:16/9;border:0;border-radius:14px;box-shadow:0 10px 26px rgba(0,0,0,.08)}
</style>
</head>
<body>
  <div class="app"><div class="card">
    <div id="progress"></div>
    <div id="screens"></div>
  </div></div>

  <!-- –õ–∞–π—Ç–±–æ–∫—Å -->
  <div id="lightbox" aria-hidden="true">
    <div class="x" id="lbClose" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</div>
    <div style="text-align:center">
      <img id="lbImg" alt=""/>
      <div class="cap" id="lbCap"></div>
    </div>
  </div>

<script>
/* ====== Helpers ====== */
const $=s=>document.querySelector(s),$$=(s,r=document)=>Array.from((r||document).querySelectorAll(s));
const vibrate=n=>{try{navigator.vibrate&&navigator.vibrate(n||12)}catch(e){}};
let A=JSON.parse(localStorage.getItem('sdq')||'{}'); const save=()=>localStorage.setItem('sdq',JSON.stringify(A));

/* dicts */
const AGE=['18‚Äì29','30‚Äì39','40‚Äì49','50+'];
const BODY=[{label:'–•—É–¥–æ—â–∞–≤–æ–µ',key:'slim',img:'skinny.png',alt:'–•—É–¥–æ—â–∞–≤–æ–µ —Ç–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏–µ'},{label:'–°—Ä–µ–¥–Ω–µ–µ',key:'avg',img:'slim.png',alt:'–°—Ä–µ–¥–Ω–µ–µ —Ç–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏–µ'},{label:'–ö—Ä—É–ø–Ω–æ–µ',key:'large',img:'medium.png',alt:'–ö—Ä—É–ø–Ω–æ–µ —Ç–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏–µ'},{label:'–ò–∑–±—ã—Ç–æ—á–Ω—ã–π –≤–µ—Å',key:'obese',img:'xl.png',alt:'–ò–∑–±—ã—Ç–æ—á–Ω—ã–π –≤–µ—Å'}];
const LIFE=['–°–∏–¥—è—á–∞—è —Ä–∞–±–æ—Ç–∞','–£–º–µ—Ä–µ–Ω–Ω–æ –∞–∫—Ç–∏–≤–Ω–∞—è','–ê–∫—Ç–∏–≤–Ω–∞—è'];
const EXP=['–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–Ω–∏–º–∞–ª–∞—Å—å','–ò–Ω–æ–≥–¥–∞ –¥–æ–º–∞ / –ø–æ –≤–∏–¥–µ–æ','–†–µ–≥—É–ª—è—Ä–Ω–æ'];
const MOT=['–î–ª—è –∑–¥–æ—Ä–æ–≤—å—è','–î–ª—è –≤–Ω–µ—à–Ω–æ—Å—Ç–∏','–î–ª—è —ç–Ω–µ—Ä–≥–∏–∏ –∏ –ª—ë–≥–∫–æ—Å—Ç–∏','–î–ª—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —Å–µ–±–µ'];
const HEALTH=['–î–∏–∞–±–µ—Ç','–ü—Ä–æ–±–ª–µ–º—ã —Å–æ —â–∏—Ç–æ–≤–∏–¥–∫–æ–π','–ì–∏–ø–µ—Ä—Ç–æ–Ω–∏—è','–ë–æ–ª—å –≤ —Å—É—Å—Ç–∞–≤–∞—Ö','–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å','–ù–µ—Ç'];

/* –ü—Ä–∏–≤—ã—á–∫–∏ */
const BAD=['–°–ª–∞–¥–∫–∏–µ –ø–µ—Ä–µ–∫—É—Å—ã','–ü–æ–ª—É—Ñ–∞–±—Ä–∏–∫–∞—Ç—ã','–ù–µ–¥–æ—Å—ã–ø','–ß–∞—Å—Ç—ã–π —Å—Ç—Ä–µ—Å—Å'];
const GOOD=['1.5‚Äì2 –ª –≤–æ–¥—ã','–û–≤–æ—â–∏ 400 –≥/–¥–µ–Ω—å','–ë–µ–ª–æ–∫ –∏ —Ñ—Ä—É–∫—Ç—ã –≤ –∫–∞–∂–¥–æ–º –ø—Ä–∏—ë–º–µ –ø–∏—â–∏','–°–æ–Ω 7-8 —á–∞—Å–æ–≤'];

/* –∫–µ–π—Å—ã –ø—Ä–∏–º–µ—Ä–æ–≤ */
const CASES = [
  { kg:14,   name:'–û–ª—å–≥–∏',         months:4, img:'olga.png' },
  { kg:10,   name:'–ê–ª–µ–∫—Å–∞–Ω–¥—Ä—ã',    months:4, img:'alexandra.png' },
  { kg:14,   name:'–ï–∫–∞—Ç–µ—Ä–∏–Ω—ã',     months:6, img:'ekaterina.jpg' },
  { kg:8,    name:'–Æ–ª–∏–∏',          months:4, img:'yulia.jpg' },
  { kg:17.5, name:'–°–≤–µ—Ç–ª–∞–Ω—ã',      months:2, img:'svetlana.jpg' },
  { kg:7,    name:'–†–µ–∑–µ–¥—ã',        months:2, img:'rezeda.jpg' },
  { kg:17.5, name:'–ò–Ω–Ω—ã',          months:5, img:'inna.jpg' },
  { kg:16,   name:'–®–∞–≥–∞—Ç–µ–ª—å–Ω–∏—Ü—ã',  months:3, img:'noname.jpg' }
];
function pickCase(targetKg){let best=null,diff=Infinity;for(const c of CASES){const d=Math.abs((c.kg||0)-targetKg);if(d<diff){diff=d;best=c}}return best}

/* scaffolding */
const screensRoot=$('#screens');
const section=(id,html)=>`<section class="screen${id==='intro'?' is':''}" data-id="${id}">${html}</section>`;
const chips=(id,arr)=>`<div class="chips" id="${id}">`+arr.map(t=>`<button type="button" class="chip" data-v="${t}">${t}</button>`).join('')+`</div>`;
const opts=(id,arr)=>`<div class="grid cols2" id="${id}">`+arr.map(t=>{
  let label,key;
  if(typeof t==='string'){label=t;key=t}
  else if(Array.isArray(t)){label=t[0];key=t[1]??t[0]}
  else if(t&&typeof t==='object'){label=t.label??t.value??t.key??'';key=t.key??t.value??t.label??''}
  else{label=String(t);key=String(t)}
  return `<label class="opt" data-v="${String(key)}"><span>${String(label)}</span></label>`;
}).join('')+`</div>`;
const actions=()=>`<div class="actions sticky"><button class="btn ghost" data-prev>–ù–∞–∑–∞–¥</button><button class="btn primary" data-next>–î–∞–ª–µ–µ</button></div>`;

/* ====== Screens HTML (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫) ====== */
const html=
section('intro',`
  <figure class="hero-wrap">
    <div class="hero-skel" id="heroSkel"></div>
    <video class="hero-media" autoplay muted playsinline loop preload="metadata" poster="logo.png">
      <source src="intro.mp4" type="video/mp4"/>
      <img src="logo.png" alt="–®–ê–ì–ê–ô –î–û–ú–ê"/>
    </video>
  </figure>
  <h1><b>–ü—Ä–æ–π–¥–∏—Ç–µ –∫–≤–∏–∑, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –ø–æ–ª—É—á–∏—Ç—Å—è –ª–∏ —É –≤–∞—Å –ø–æ—Ö—É–¥–µ—Ç—å –Ω–∞ —à–∞–≥–∞—Ö‚Ä¶</b></h1>
  <p class="hint"><b>‚Ä¶–∞ —Ç–∞–∫–∂–µ –ø–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—É—é –ø—Ä–æ–±–Ω—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –∏ —Å–∫–∏–¥–∫—É 70% –Ω–∞ –Ω–∞—à–∏ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã!</b></p>
  <div class="grid">
    <div>
      <div class="hint">–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?</div>
      <input id="name" class="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò—Ä–∏–Ω–∞" autocomplete="name">
    </div>
  </div>
  <div class="actions sticky"><button class="btn primary" data-next id="startBtn">–ü–æ–µ—Ö–∞–ª–∏ ‚Üí</button></div>
`)
+section('age',`<h2>–í–∞—à –≤–æ–∑—Ä–∞—Å—Ç</h2>${opts('ageOpts',AGE)}${actions()}`)
+section('promo1',`
  <div class="promo">
    <figure class="promo-hero">
      <img src="2.jpg" alt="–®–ê–ì–ê–ô –î–û–ú–ê‚ö° ‚Äî –±–æ–ª—å—à–µ 1 –º–ª–Ω –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤" loading="lazy" decoding="async">
    </figure>
    <h2>–£ –®–ê–ì–ê–ô –î–û–ú–ê‚ö° —É–∂–µ –±–æ–ª—å—à–µ <b>1&nbsp;–º–∏–ª–ª–∏–æ–Ω–∞</b> –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –≤–æ –≤—Å–µ—Ö —Å–æ—Ü—Å–µ—Ç—è—Ö!</h2>
    <p class="hint"> –ú—ã ‚Äî –æ–¥–Ω–æ –∏–∑ —Å–∞–º—ã—Ö –¥—Ä—É–∂–µ–ª—é–±–Ω—ã—Ö —Ñ–∏—Ç–Ω–µ—Å-—Å–æ–æ–±—â–µ—Å—Ç–≤.</p>
    ${actions()}
  </div>
`)
+section('body',`
  <h2>–¢–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏–µ —Å–µ–π—á–∞—Å</h2>
  <div class="grid cols2" id="bodyOpts">
    ${BODY.map(o=>`<label class="opt opt--img" data-v="${o.key}"><img src="${o.img}" alt="${o.alt}"><span>${o.label}</span></label>`).join('')}
  </div>${actions()}
`)
+section('steps',`
  <h2>–°–∫–æ–ª—å–∫–æ —à–∞–≥–æ–≤ –≤—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç–µ —Å–µ–π—á–∞—Å –≤ –¥–µ–Ω—å (–ø—Ä–∏–º–µ—Ä–Ω–æ)?</h2>
  <input id="steps" type="range" min="0" max="25000" step="250" value="4000">
  <div class="hint">–°–µ–π—á–∞—Å: <b><span id="sv">4000</span> —à–∞–≥–æ–≤</b></div>
  <p class="hint"><b>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</b> –Ω–∞–π—Ç–∏ —à–∞–≥–∏ –º–æ–∂–Ω–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤–∞—à–µ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞/–±—Ä–∞—Å–ª–µ—Ç–∞</p>
  ${actions()}
`)
+section('promo2',`
  <div class="promo">
    <figure class="promo-hero">
      <img src="otzyv.jpg" alt="–£–∂–µ –±–æ–ª—å—à–µ 10 000 –ª—é–¥–µ–π –≤ –∫–ª—É–±–µ" loading="lazy" decoding="async">
    </figure>
    <h2>–£–∂–µ –±–æ–ª—å—à–µ <b>10&nbsp;000</b> –ª—é–¥–µ–π –≤ –æ–Ω–ª–∞–π–Ω-–∫–ª—É–±–µ –®–ê–ì–ê–ô –î–û–ú–ê ‚ö°</h2>
    <p class="hint">–ö–∞–∂–¥—ã–π –Ω–∞ —Å–≤–æ—ë–º —É—Ä–æ–≤–Ω–µ, –Ω–æ –≤–º–µ—Å—Ç–µ –º—ã ‚Äî —Å–∏–ª—å–Ω–µ–µ.</p>
    ${actions()}
  </div>
`)
+section('bmi',`
  <h2>–î–∞–≤–∞–π—Ç–µ –ø–æ—Å—á–∏—Ç–∞–µ–º –≤–∞—à –ò–ú–¢</h2>
  <p class="hint">–£–∫–∞–∂–∏—Ç–µ –≤–∞—à —Ä–æ—Å—Ç –∏ –≤–µ—Å ‚Äî –º–æ–∂–Ω–æ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ. –ú—ã –ø–æ–∫–∞–∂–µ–º, —á—Ç–æ —Ç–∞–∫–æ–µ –ò–ú–¢ –∏ –≤ –∫–∞–∫–æ–π –∑–æ–Ω–µ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å.</p>
  <div class="grid cols2">
    <div><div class="hint">–†–æ—Å—Ç, —Å–º</div><input id="h" type="number" class="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 165"></div>
    <div><div class="hint">–í–µ—Å, –∫–≥</div><input id="w" type="number" class="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 72"></div>
  </div>
  <div id="bmiI" class="hint"></div>
  ${actions()}
`)
+section('life',`<h2>–û–±—Ä–∞–∑ –∂–∏–∑–Ω–∏</h2>${opts('lifeOpts',LIFE)}${actions()}`)
+section('exp',`<h2>–û–ø—ã—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h2>${opts('expOpts',EXP)}${actions()}`)
+section('promo3',`
  <div class="promo">
    <figure class="promo-hero">
      <img src="walkwalk.jpg" alt="20 –º–∏–ª–ª–∏–æ–Ω–æ–≤ —à–∞–≥–æ–≤ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å" loading="lazy" decoding="async">
    </figure>
    <h2><b>20&nbsp;–º–∏–ª–ª–∏–æ–Ω–æ–≤</b> —à–∞–≥–æ–≤ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–∞–±–∏—Ä–∞—é—Ç —É—á–∞—Å—Ç–Ω–∏—Ü—ã –∫–ª—É–±–∞ üòç</h2>
    <p class="hint">–ö–æ—Ä–æ—Ç–∫–∏–µ —à–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ ‚Äî –ª–µ–≥–∫–æ –≤–ø–∏—Å–∞—Ç—å –≤ –¥–µ–Ω—å.</p>
    ${actions()}
  </div>
`)
+section('goal',`
  <h2>–í–∞—à–∞ —Ü–µ–ª—å</h2>
  <div class="goalw">
    <div class="goal-top">
      <div class="goal-card">
        <div class="goal-range">
          <div class="val"><span class="minus">‚àí</span><span id="goalVal">5.0</span> –∫–≥</div>
          <div class="sub"><span id="goalBadge" class="goal-badge goal-mid">—É–º–µ—Ä–µ–Ω–Ω–æ</span></div>
        </div>
        <input id="goalRange" type="range" min="0" max="20" step="0.5" value="5">
        <div class="hint">–ü–æ—Ç—è–Ω–∏—Ç–µ –ø–æ–ª–∑—É–Ω–æ–∫: 0 ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ñ–æ—Ä–º—É ¬∑ 20 ‚Äî –∞–º–±–∏—Ü–∏–æ–∑–Ω–∞—è —Ü–µ–ª—å</div>
        <label class="goal-switch" style="margin-top:10px"><input id="goalKeep" type="checkbox"><span>–ù–∞–∫–∞—á–∞—Ç—å –º—ã—à—Ü—ã</span></label>
      </div>
      <div class="goal-fig">
        <div class="goal-stack" id="goalStack">
          <img src="superfit.png" data-i="0" alt="superfit" loading="lazy" decoding="async">
          <img src="fit.png"      data-i="1" alt="fit"      loading="lazy" decoding="async">
          <img src="skinny.png"   data-i="2" alt="skinny"   loading="lazy" decoding="async">
          <img src="slim.png"     data-i="3" alt="slim"     loading="lazy" decoding="async">
          <img src="s.png"        data-i="4" alt="s"        loading="lazy" decoding="async">
          <img src="m.png"        data-i="5" alt="m"        loading="lazy" decoding="async">
          <img src="l.png"        data-i="6" alt="l"        loading="lazy" decoding="async">
          <img src="xl.png"       data-i="7" alt="xl"       loading="lazy" decoding="async">
          <img src="xxl.png"      data-i="8" alt="xxl"      loading="lazy" decoding="async">
          <div class="tape" id="goalTape"></div>
        </div>
      </div>
    </div>
    <p class="goal-note">–¶–µ–ª—å –º–æ–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å –ø–æ–∑–∂–µ ‚Äî —Ä–∞—Å—á—ë—Ç –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ –≤–∞—à —Ç–µ–º–ø –∏ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ.</p>
    ${actions()}
  </div>
`)
+section('motivation',`<h2>–ü–æ—á–µ–º—É –≤—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è —Å–ø–æ—Ä—Ç–æ–º?</h2>${chips('motChips',MOT)}${actions()}`)
+section('perweek',`
  <h2>–°–∫–æ–ª—å–∫–æ –≥–æ—Ç–æ–≤—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –Ω–µ–¥–µ–ª—é?</h2>
  ${chips('pwChips',['2 —Ä–∞–∑–∞','3 —Ä–∞–∑–∞','4‚Äì5 —Ä–∞–∑','–ö–∞–∂–¥—ã–π –¥–µ–Ω—å 20‚Äì30 –º–∏–Ω'])}
  <div id="aha" class="aha hidden"></div>
  ${actions()}
`)
+section('promo4',`
  <div class="promo">
    <figure class="promo-hero">
      <img src="doposle.jpg" alt="85% –∂–µ–Ω—â–∏–Ω –≤ –∫–ª—É–±–µ –ø–æ—Ö—É–¥–µ–ª–∏ –Ω–∞ 1‚Äì2 –∫–≥ –∑–∞ –ø–µ—Ä–≤—É—é –Ω–µ–¥–µ–ª—é" loading="lazy" decoding="async">
    </figure>
    <h2><b>85%</b> –∂–µ–Ω—â–∏–Ω –≤ –∫–ª—É–±–µ –ø–æ—Ö—É–¥–µ–ª–∏ –Ω–∞ <b>1‚Äì2&nbsp;–∫–≥</b> –∑–∞ –ø–µ—Ä–≤—É—é –Ω–µ–¥–µ–ª—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ üî•</h2>
    <p class="hint">–°—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –ª–µ–≥–∫–æ, –∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ—Ç–∏–≤–∏—Ä—É—é—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å.</p>
    ${actions()}
  </div>
`)
+section('hard',`
  <h2>–ß—Ç–æ —Å–µ–π—á–∞—Å –¥–∞—ë—Ç—Å—è —Ç—è–∂–µ–ª–µ–µ –≤—Å–µ–≥–æ?</h2>
  <div class="hardw">
    <div class="hard-cards" id="hardCards">
      <div class="hcard" data-k="walk"><div class="hhead"><div class="hicon">üö∂‚Äç‚ôÄÔ∏è</div><div>–î–æ–ª–≥–∞—è –ø—Ä–æ–≥—É–ª–∫–∞ —É—Ç–æ–º–ª—è–µ—Ç</div></div></div>
      <div class="hcard" data-k="stairs"><div class="hhead"><div class="hicon">ü™ú</div><div>–ö–∞–∂–¥—ã–π –ø—Ä–æ–ª—ë—Ç –ø–æ –ª–µ—Å—Ç–Ω–∏—Ü–µ ‚Äî –∏—Å–ø—ã—Ç–∞–Ω–∏–µ</div></div></div>
      <div class="hcard" data-k="games"><div class="hhead"><div class="hicon">üéØ</div><div>–°—Ç—ã–¥–Ω–æ –≤–∫–ª—é—á–∞—Ç—å—Å—è –≤ –∞–∫—Ç–∏–≤–Ω—ã–µ –∏–≥—Ä—ã</div></div></div>
      <div class="hcard" data-k="jumps"><div class="hhead"><div class="hicon">ü¶ò</div><div>–ü—Ä—ã–∂–∫–∏</div></div></div>
      <div class="hcard" data-k="none"><div class="hhead"><div class="hicon">‚úÖ</div><div>–ù–∏—á–µ–≥–æ –∏–∑ —ç—Ç–æ–≥–æ</div></div></div>
    </div>
    ${actions()}
  </div>
`)
+section('health',`<h2>–ï—Å—Ç—å –ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –≤–∞–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å?</h2>${chips('healthChips',HEALTH)}<p class="hint">–ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ–º–Ω–µ–Ω–∏—è ‚Äî –ø—Ä–æ–∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π—Ç–µ—Å—å —Å –≤—Ä–∞—á–æ–º.</p>${actions()}`)
+section('nutrition',`<h2>–ü–∏—Ç–∞–Ω–∏–µ</h2>${opts('nutriOpts',[{label:'–ë—É–¥—É –ø–∏—Ç–∞—Ç—å—Å—è –ø–æ –º–µ–Ω—é-–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—É –≤ –∫–ª—É–±–µ',key:'menu'},{label:'–•–æ—á—É –Ω–∞—É—á–∏—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å —Ç–∞—Ä–µ–ª–∫—É',key:'plate'},{label:'–ù–µ—Ç, –ø–æ–∫–∞ –±–µ–∑ –ø–∏—Ç–∞–Ω–∏—è',key:'no'}])}${actions()}`)
+section('food',`
  <h2>–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –Ω–∞–º –æ –≤–∞—à–∏—Ö —Ç–µ–∫—É—â–∏—Ö –ø—Ä–∏–≤—ã—á–∫–∞—Ö</h2>
  <div class="habit">
    <div class="habit-grid">
      <div class="col">
        <h3>–ü–ª–æ—Ö–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏</h3>
        <div class="chips chips--pills" id="bad">
          ${BAD.map(x=>`<button type="button" class="chip" data-kind="bad" data-v="${x}">${x}</button>`).join('')}
        </div>
      </div>
      <div class="col">
        <h3>–•–æ—Ä–æ—à–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏</h3>
        <div class="chips chips--pills" id="good">
          ${GOOD.map(x=>`<button type="button" class="chip" data-kind="good" data-v="${x}">${x}</button>`).join('')}
        </div>
      </div>
    </div>

    <div class="habit-meter hidden" id="hmWrap">
      <div class="hm-top"><div><span id="hmLabel">–ò–Ω–¥–µ–∫—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</span><span class="hm-badge hm-ok" id="hmBadge">–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ</span></div><span id="hmScore">0%</span></div>
      <div class="hm-track" id="hmTrack"><div class="hm-pointer" id="hmPtr"></div></div>
      <div class="hm-scale"><span>—Ç–æ—Ä–º–æ–∑–∏—Ç</span><span>–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ</span><span>—É—Å–∫–æ—Ä—è–µ—Ç</span></div>
    </div>

    <p class="hint">–û—Ç–º–µ—Ç—å—Ç–µ —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –ø—Ä–æ –≤–∞—Å ‚Äî –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ—è–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚ú®</p>
    <div class="actions sticky"><button class="btn ghost" data-prev>–ù–∞–∑–∞–¥</button><button class="btn primary" id="calc">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí</button></div>
  </div>
`)
+section('trial',`
  <h2>–£—Ä–∞! –í—ã –æ—Ç–≤–µ—Ç–∏–ª–∏ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã üéâ</h2>
  <p class="hint">–¢–µ–ø–µ—Ä—å –≤–∞–º –¥–æ—Å—Ç—É–ø–Ω–∞ –ø—Ä–æ–±–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞. –ï—Å–ª–∏ –≤–∏–¥–µ–æ –Ω–µ –≥—Ä—É–∑–∏—Ç—Å—è ‚Äî –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–∏–∂–µ.</p>
  <div class="tabs">
    <button class="tab is" data-tab="vk">VK –í–∏–¥–µ–æ</button>
    <button class="tab" data-tab="yt">YouTube</button>
    <button class="tab" data-tab="rt">Rutube</button>
  </div>
  <div class="player">
    <div data-pane="vk">
      <iframe src="https://vk.com/video_ext.php?oid=-222534261&id=456239990&hd=2"
              allow="autoplay; encrypted-media; fullscreen; picture-in-picture" allowfullscreen loading="lazy"></iframe>
    </div>
    <div data-pane="yt" style="display:none">
      <iframe src="https://www.youtube.com/embed/TFltKZJoV2g"
              title="–ü—Ä–æ–±–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen loading="lazy"></iframe>
    </div>
    <div data-pane="rt" style="display:none">
      <iframe src="https://rutube.ru/video/private/fbad797705787d6048d2344b7aa55a90/?r=a&p=93p6xGkyvbtXxF38SzuoSw"
              allow="autoplay; encrypted-media; fullscreen; picture-in-picture" allowfullscreen loading="lazy"></iframe>
    </div>
  </div>
  <div class="actions sticky">
    <button class="btn ghost" data-prev>–ù–∞–∑–∞–¥</button>
    <button class="btn primary" id="goForecast">–£–∑–Ω–∞—Ç—å –º–æ–π –ø—Ä–æ–≥–Ω–æ–∑ ‚Üí</button>
  </div>
`)
+section('loading',`
  <div class="loader2"><div class="ring" id="lring"><div class="pct" id="lpct">0%</div></div>
  <div class="lmsg" id="lmsg">–°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ‚Ä¶</div><p class="hint" id="lsub">–í–æ–∑—Ä–∞—Å—Ç ‚Ä¢ –ò–ú–¢ ‚Ä¢ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Ä¢ –¶–µ–ª—å</p></div>
`)
+section('result',`
  <h2 id="rTitle">–ì–æ—Ç–æ–≤–æ!</h2>
  <div class="counter" id="nums">0 –∫–≥ –∑–∞ 0 –Ω–µ–¥–µ–ª—å</div>
  <p class="hint" id="rSub"></p>
  <div id="caseBox" class="case hide"></div>

  <div id="offerInline" class="offer-inline" style="display:none">
    <p class="hint" style="margin:0 0 8px 0"><b>–¢–æ–ª—å–∫–æ –¥–ª—è –≤–∞—Å —É –Ω–∞—Å –¥–µ–π—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: ‚àí70% –Ω–∞ –≤—Å–µ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã –≤ –∫–ª—É–±!</b></p>
    <div class="deal"><div class="deal-row" style="justify-content:flex-end">
      <span class="deal-timer" id="inlineTimer">15:00</span><span class="deal-badge">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ</span>
    </div></div>
    <div class="actions" style="margin-top:10px"><button class="btn primary" id="toPrograms">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É</button></div>
  </div>

  <p class="hint" id="rDisc">–ü—Ä–æ–≥–Ω–æ–∑ –Ω–æ—Å–∏—Ç –æ–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π.</p>
  <div class="actions sticky">
    <button class="btn ghost" data-prev>–ù–∞–∑–∞–¥</button>
    <button class="btn primary" id="toCTA">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—é!</button>
  </div>
`)
+section('program',`
  <div class="prog-wrap">
    <div class="prog-head">
      <div class="p-title" id="progTitle">–ú—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≤–∞–º‚Ä¶</div>
      <p class="p-sub" id="progLead"></p>
      <div class="p-chips" id="progChips"></div>
    </div>

    <figure class="prog-hero">
      <img src="program.png" alt="–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞">
    </figure>

    <div class="prog-card">
      <h3>–ü–æ—á–µ–º—É —ç—Ç–æ –ø–æ–¥–æ–π–¥—ë—Ç –∏–º–µ–Ω–Ω–æ –≤–∞–º</h3>
      <ul class="prog-list" id="progList"></ul>
    </div>

    <div class="actions sticky">
      <button class="btn ghost" data-prev>–ù–∞–∑–∞–¥</button>
      <button class="btn primary" id="toSale">–ö –ø—Ä–æ–≥—Ä–∞–º–º–µ ‚Üí</button>
    </div>
  </div>
`)
+section('sale',`
  <figure class="sale-hero"><img src="final.jpg" alt="–û–Ω–ª–∞–π–Ω-–∫–ª—É–± –®–ê–ì–ê–ô –î–û–ú–ê ‚ö°"></figure>
  <h2 id="sTitle">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–ª—É–± ¬´–®–ê–ì–ê–ô –î–û–ú–ê¬ª ‚ö°</h2>
  <p id="sLead" class="hint"></p>
  <div class="deal">
    <div class="deal-row">
      <span class="deal-badge">‚àí70% —Ç–æ–ª—å–∫–æ —Å–µ–π—á–∞—Å</span>
      <span class="deal-timer" id="saleTimer">15:00</span>
    </div>
  </div>
  <div class="actions sticky">
    <button class="btn ghost" data-prev>–ù–∞–∑–∞–¥</button>
    <a class="btn primary" id="buyBtn" href="https://walk-walk.ru/?utm_source=website&utm_medium=quiz&utm_campaign=looseweight" target="_blank" rel="noopener">–•–æ—á—É –∞–±–æ–Ω–µ–º–µ–Ω—Ç —Å–æ —Å–∫–∏–¥–∫–æ–π 70%!</a>
  </div>
`);

/* Mount HTML */
screensRoot.innerHTML=html;

/* ====== Top progress + discount ====== */
const progressRoot=$('#progress');
progressRoot.innerHTML=`
  <div class="pcirc"><div class="pct" id="pct">0%</div></div>
  <div id="disc" role="status" aria-live="polite">
    <span class="i">–í–∞—à–∞ —Å–∫–∏–¥–∫–∞:</span> <span id="discPct">0%</span>
    <span class="tooltip" title="–†–∞—Å—Ç—ë—Ç —Å –∫–∞–∂–¥—ã–º –≤–æ–ø—Ä–æ—Å–æ–º!">‚ìò</span>
  </div>
  <div class="plogo"><img src="logo.png" alt="–®–ê–ì–ê–ô –î–û–ú–ê"></div>
`;

/* ====== –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —ç–∫—Ä–∞–Ω–æ–≤ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏ —Å–∫–∏–¥–∫–∏ ====== */
const FLOW_ORDER=[
  'intro',
  'age','promo1','body','steps','promo2','bmi','life','exp','promo3',
  'goal','motivation','perweek','promo4','hard','health','nutrition','food',
  'trial','loading','result','program','sale'
];
const DISCOUNT_STEPS=['age','body','steps','bmi','life','exp','goal','motivation','perweek','hard','health','nutrition','food']; // —Ç–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å—ã/–≤–∞–∂–Ω—ã–µ –±–ª–æ–∫–∏

/* ====== State & Navigation ====== */
let idx=0;
const screens=$$('#screens .screen');
const idxBy=id=>screens.findIndex(s=>s.dataset.id===id);

function show(i){
  if(i<0||i>=screens.length)return;
  screens[idx].classList.remove('is'); idx=i; screens[idx].classList.add('is');
  updateProgress();
  updateDiscountVisibility();
  handleScreenEnter(screens[idx].dataset.id);
  window.scrollTo({top:0,behavior:'smooth'});
}
function next(){ show(idx+1) }
function prev(){ show(idx-1) }
screensRoot.addEventListener('click',e=>{
  const t=e.target;
  if(t.matches('[data-next]')){ e.preventDefault(); next(); }
  if(t.matches('[data-prev]')){ e.preventDefault(); prev(); }
});

/* START: —Å–±—Ä–æ—Å –ø—Ä–æ—à–ª—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤, —á—Ç–æ–±—ã –Ω–µ —Å–∫–∞–∫–∞–ª–∞ —Å–∫–∏–¥–∫–∞ */
$('#startBtn')?.addEventListener('click',e=>{
  e.preventDefault();
  const name=$('#name').value?.trim();
  localStorage.removeItem('sdq');
  A={};
  if(name) A.name=name;
  save();
  // —Å–±—Ä–æ—Å –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
  $('#discPct').textContent='0%';
  $('#disc').classList.remove('win');
  show(idxBy('age'));
});

/* –≤—ã–±–æ—Ä –æ–ø—Ü–∏–π */
function bindChips(id,key,single=true){
  const wrap=$('#'+id); if(!wrap) return;
  wrap.addEventListener('click',e=>{
    const b=e.target.closest('.chip'); if(!b) return;
    if(single){ $$('.chip',wrap).forEach(x=>x.classList.remove('is')); b.classList.add('is'); A[key]=b.dataset.v; }
    else{ b.classList.toggle('is');
      const set=new Set(A[key]||[]); b.classList.contains('is')?set.add(b.dataset.v):set.delete(b.dataset.v); A[key]=[...set];
    }
    save(); vibrate(8);
    if(id==='pwChips') revealAha();
  });
}
function bindOpts(id,key){
  const wrap=$('#'+id); if(!wrap) return;
  wrap.addEventListener('click',e=>{
    const o=e.target.closest('.opt'); if(!o) return;
    $$('.opt',wrap).forEach(x=>x.classList.remove('is')); o.classList.add('is'); A[key]=o.dataset.v; save(); vibrate(8);
  });
}

/* inputs */
$('#name').addEventListener('input',e=>{A.name=e.target.value;save()});
const sv=$('#sv'); const stepsInput=$('#steps');
if(stepsInput){ const upd=()=>{sv.textContent=+stepsInput.value; stepsInput.style.setProperty('--pct', (stepsInput.value/25000*100)+'%'); A.steps=+stepsInput.value; save()}; stepsInput.addEventListener('input',upd); upd(); }

/* BMI */
function updateBMI(){
  const h=+$('#h').value||0, w=+$('#w').value||0; A.h=h; A.w=w; save();
  const out=$('#bmiI'); if(!(h&&w)){ out.innerHTML=''; return; }
  const m=h/100, bmi=(w/(m*m)); A.bmi=+bmi.toFixed(1);
  let tag='bmi-ok', text='–Ω–æ—Ä–º–∞'; if(bmi>=30){tag='bmi-bad';text='–æ–∂–∏—Ä–µ–Ω–∏–µ';} else if(bmi>=25){tag='bmi-warn';text='–∏–∑–±—ã—Ç–æ—á–Ω–∞—è –º–∞—Å—Å–∞';} else if(bmi<18.5){tag='bmi-warn';text='–Ω–∏–∂–µ –Ω–æ—Ä–º—ã';}
  out.innerHTML=`–í–∞—à –ò–ú–¢: <b>${bmi.toFixed(1)}</b> ‚Äî <span class="bmi-tag ${tag}">${text}</span><div class="bmi-line">–ò–Ω–¥–µ–∫—Å –º–∞—Å—Å—ã —Ç–µ–ª–∞ –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω –≤–µ—Å–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä–æ—Å—Ç–∞.</div>`;
}
$('#h')?.addEventListener('input',updateBMI);
$('#w')?.addEventListener('input',updateBMI);

/* Goal slider + silhouettes */
const goalRange=$('#goalRange'), goalVal=$('#goalVal'), goalBadge=$('#goalBadge');
function updGoalUI(){
  const v=+goalRange.value; goalVal.textContent=v.toFixed(1);
  const b=v<4?'–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å':(v<8?'—É–º–µ—Ä–µ–Ω–Ω–æ':'–∞–º–±–∏—Ü–∏–æ–∑–Ω–æ');
  goalBadge.textContent=b;
  A.goalKg=v; save();
  const idxImg = v>=16?8 : v>=13?7 : v>=10?6 : v>=8?5 : v>=6?4 : v>=4?3 : v>=2?2 : v>0?1 : 0;
  $$('#goalStack img').forEach((img,j)=>{img.style.opacity = (j===idxImg)?1:0;});
}
goalRange?.addEventListener('input',updGoalUI);
$('#goalKeep')?.addEventListener('change',e=>{A.keep=!!e.target.checked; save()});

/* Hard cards */
$('#hardCards')?.addEventListener('click',e=>{
  const c=e.target.closest('.hcard'); if(!c) return;
  $$('.hcard').forEach(x=>x.classList.remove('is')); c.classList.add('is'); A.hardKey=c.dataset.k; save(); vibrate(8);
});

/* Habits meter */
function updateHabitMeter(){
  const bad=new Set(A.bad||[]), good=new Set(A.good||[]);
  const wrap=$('#hmWrap'); if(!wrap) return;
  const delta = Math.min(100, Math.max(-100, good.size*12 - bad.size*15));
  const pct = Math.round(50 + delta/2); // 0..100
  $('#hmPtr').style.left=pct+'%';
  $('#hmScore').textContent = (delta>0?'+':'') + delta + '%';
  let badge='hm-ok', text='–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ'; if(delta<=-20){badge='hm-bad';text='—Ç–æ—Ä–º–æ–∑–∏—Ç'} else if(delta>=20){badge='hm-good';text='—É—Å–∫–æ—Ä—è–µ—Ç'}
  $('#hmBadge').className='hm-badge '+badge; $('#hmBadge').textContent=text;
  wrap.classList.remove('hidden');
}
$('#bad')?.addEventListener('click',e=>{
  const chip=e.target.closest('.chip'); if(!chip) return;
  chip.classList.toggle('is');
  const set=new Set(A.bad||[]); chip.classList.contains('is')?set.add(chip.dataset.v):set.delete(chip.dataset.v); A.bad=[...set]; save(); updateHabitMeter();
});
$('#good')?.addEventListener('click',e=>{
  const chip=e.target.closest('.chip'); if(!chip) return;
  chip.classList.toggle('is');
  const set=new Set(A.good||[]); chip.classList.contains('is')?set.add(chip.dataset.v):set.delete(chip.dataset.v); A.good=[...set]; save(); updateHabitMeter();
});

/* Chips bindings */
bindChips('ageOpts','age');
bindOpts('bodyOpts','body');
bindChips('lifeOpts','life');
bindChips('expOpts','exp');
bindChips('motChips','mot');
bindChips('pwChips','perweek');
bindChips('healthChips','health',false);
bindChips('nutriOpts','nutri');

/* Aha for perweek (chart appears only after choice) */
function revealAha(){
  const aha=$('#aha'); if(!A.perweek){aha.classList.add('hidden'); aha.innerHTML=''; return;}
  const map={
    '2 —Ä–∞–∑–∞':'–°—Ç–∞—Ä—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º: 2 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤ –Ω–µ–¥–µ–ª—é ‚Äî –º—è–≥–∫–∏–π, –Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å.',
    '3 —Ä–∞–∑–∞':'–ó–æ–ª–æ—Ç–∞—è —Å–µ—Ä–µ–¥–∏–Ω–∞: 3 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤ –Ω–µ–¥–µ–ª—é —É—Å–∫–æ—Ä—è—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç.',
    '4‚Äì5 —Ä–∞–∑':'–£—Å–∫–æ—Ä–µ–Ω–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å: 4‚Äì5 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –±—ã—Å—Ç—Ä–µ–µ –ø—Ä–∏–≤–µ–¥—É—Ç –∫ —Ü–µ–ª–∏.',
    '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å 20‚Äì30 –º–∏–Ω':'–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∫–æ—Ä–æ—Ç–∫–∏–µ ‚Äî —Ç–æ–ø –¥–ª—è –ø—Ä–∏–≤—ã—á–∫–∏ –∏ —à–∞–≥–æ-–æ–±—ä—ë–º–∞.'
  };
  aha.classList.remove('hidden');
  aha.innerHTML=`<strong>${map[A.perweek]||''}</strong><br><small>–ù–∏–∂–µ ‚Äî –æ—Ä–∏–µ–Ω—Ç–∏—Ä –≤–∞—à–µ–≥–æ –æ–±—ä—ë–º–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</small><img src="chart.png" alt="–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π –æ–±—ä—ë–º" style="max-height:240px;object-fit:contain">`;
}

/* Tabs for trial video */
$$('.tab').forEach(tab=>{
  tab.addEventListener('click',()=>{
    $$('.tab').forEach(x=>x.classList.remove('is')); tab.classList.add('is');
    const k=tab.dataset.tab;
    $$('[data-pane]').forEach(p=>p.style.display = (p.getAttribute('data-pane')===k)?'block':'none');
  });
});

/* ====== Progress + Discount (–ø–æ –∏–Ω–¥–µ–∫—Å—É —ç–∫—Ä–∞–Ω–∞, –∞ –Ω–µ –ø–æ –æ—Ç–≤–µ—Ç–∞–º) ====== */
const discEl=$('#disc'), discPct=$('#discPct');
function updateDiscountVisibility(){
  const id=screens[idx].dataset.id;
  const visible = FLOW_ORDER.indexOf(id) >= FLOW_ORDER.indexOf('age'); // —Å–æ 2-–≥–æ —ç–∫—Ä–∞–Ω–∞
  discEl.style.display = visible ? 'inline-flex' : 'none';
}
function discountByIndex(){
  // —Å—á–∏—Ç–∞–µ–º, —Å–∫–æ–ª—å–∫–æ DISCOUNT_STEPS —É–∂–µ –ø—Ä–æ–π–¥–µ–Ω–æ –∫ —Ç–µ–∫—É—â–µ–º—É —ç–∫—Ä–∞–Ω—É
  const currentId=screens[idx].dataset.id;
  const currentPos=FLOW_ORDER.indexOf(currentId);
  let seen=0;
  for(const id of DISCOUNT_STEPS){
    if(FLOW_ORDER.indexOf(id) <= currentPos) seen++;
  }
  return Math.min(70, Math.round(seen / DISCOUNT_STEPS.length * 70));
}
function updateDiscount(){
  const pct=discountByIndex();
  discPct.textContent=pct+'%';
  discEl.classList.toggle('win', pct>=70);
}
function updateProgress(){
  const current=idxBy(screens[idx].dataset.id); // —Ç–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å –≤ –º–∞—Å—Å–∏–≤–µ screens
  const p=Math.round(((current+1)/screens.length)*100);
  $('#pct').textContent=p+'%';
  updateDiscount();
}

/* ====== Loading & Result calculation ====== */
function runLoading(done){
  const ring=$('#lring'),lpct=$('#lpct'),lmsg=$('#lmsg'),lsub=$('#lsub');
  const stepsTxt=['–£—á–∏—Ç—ã–≤–∞–µ–º –≤–∞—à –≤–æ–∑—Ä–∞—Å—Ç','–°–º–æ—Ç—Ä–∏–º —Ç–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏–µ –∏ –ò–ú–¢','–ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –æ–ø—ã—Ç','–î–æ–±–∞–≤–ª—è–µ–º —à–∞–≥–∏ –∏ –ø–∏—Ç–∞–Ω–∏–µ','–ì–æ—Ç–æ–≤–∏–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑‚Ä¶'];
  let si=0;lmsg.textContent=stepsTxt[0];lsub.textContent='–í–æ–∑—Ä–∞—Å—Ç ‚Ä¢ –ò–ú–¢ ‚Ä¢ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Ä¢ –¶–µ–ª—å';
  const D=1500,t0=performance.now();
  function tick(n){
    const p=Math.min(1,(n-t0)/D),ease=1-Math.pow(1-p,3),pct=Math.round(5+95*ease);
    ring.style.setProperty('--p',pct+'%');lpct.textContent=pct+'%';
    const i=Math.min(stepsTxt.length-1,Math.floor(p*stepsTxt.length));
    if(i!==si){si=i;lmsg.textContent=stepsTxt[si]}
    if(p<1)requestAnimationFrame(tick);else setTimeout(()=>{ try{ done(); } catch(err){ console.error(err); fallbackResult(); } },200)
  }
  requestAnimationFrame(tick)
}
function fallbackResult(){
  const name=A.name?.trim()||'–î—Ä—É–∑—å—è';
  $('#rTitle').textContent=`${name}, –≤–∞—à –ø—Ä–æ–≥–Ω–æ–∑ –≥–æ—Ç–æ–≤ ‚ú®`;
  $('#nums').textContent=`‚âà ‚àí${goalKg()} –∫–≥ –∑–∞ 8 –Ω–µ–¥–µ–ª—å`;
  $('#rSub').textContent='–ú—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª–∏ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–π –ø–ª–∞–Ω –ø–æ –≤–∞—à–∏–º –¥–∞–Ω–Ω—ã–º.';
  show(idxBy('result'));
}

/* –§–∞–∫—Ç–æ—Ä—ã */
function fAge(){const a=A.age||'';if(/50/.test(a))return 0.88;if(/40/.test(a))return 0.94;if(/30/.test(a))return 0.98;return 1.06}
function fLife(){const l=A.life||'';if(/–°–∏–¥—è—á–∞—è/.test(l))return 0.90;if(/–£–º–µ—Ä–µ–Ω–Ω–æ/.test(l))return 1.00;return 1.08}
function fExp(){const e=A.exp||'';if(/–ù–∏–∫–æ–≥–¥–∞/.test(e))return 0.95;if(/–†–µ–≥—É–ª—è—Ä–Ω–æ/.test(e))return 1.08;return 1.00}
function fBody(){switch(A.body){case 'slim':return .92;case 'avg':return 1.00;case 'large':return .96;case 'obese':return .92;default:return 1.00}}
function fSteps(){const now=+A.steps||4000,add=2000,t=now+add;let boost=1+add/10000;if(now<3000)boost+=.08;if(now>9000)boost-=.06;return{f:Math.max(.95,Math.min(1.28,boost)),t}}
function fNutri(){let f=1;if(A.nutri==='menu')f+=.22;else if(A.nutri==='plate')f+=.12;else f-=.12;f-=((A.bad||[]).length)*.03;f+=Math.min(((A.good||[]).length)*.02,10);return Math.max(.7,Math.min(1.35,f))}
function fHealth(){const h=new Set(A.health||[]);let f=1;if(h.has('–î–∏–∞–±–µ—Ç')||h.has('–ü—Ä–æ–±–ª–µ–º—ã —Å–æ —â–∏—Ç–æ–≤–∏–¥–∫–æ–π')||h.has('–ì–∏–ø–µ—Ä—Ç–æ–Ω–∏—è'))f-=.06;if(h.has('–ë–æ–ª—å –≤ —Å—É—Å—Ç–∞–≤–∞—Ö'))f-=.04;return Math.max(.8,f)}
function fPain(){switch(A.hardKey){case 'walk':return .94;case 'stairs':return .93;case 'games':return .96;case 'jumps':return .95;case 'none':return 1.02;default:return 1.00}}
function rate(){
  const w=+A.w||0;
  if(w>=100) return 1.0;
  let r=.5;
  const bmi=A.bmi||26;
  if(bmi>=30) r+=.08; else if(bmi<23) r-=.08;
  r*=fAge()*fLife()*fExp()*fBody()*fSteps().f*fNutri()*fHealth()*fPain();
  return Math.max(.25,Math.min(.9,+r.toFixed(2)));
}
function fmtDuration(wks){
  if(wks<=10){return{start:12,value:wks,unitText:'–Ω–µ–¥–µ–ª—å',label:`${wks} –Ω–µ–¥–µ–ª—å`}}
  const months=Math.ceil(wks/4);return{start:6,value:months,unitText:'–º–µ—Å.',label:`${months} –º–µ—Å.`}
}
function goalKg(){
  if(A.goalKg!=null) return Math.max(0,Math.min(20,+A.goalKg));
  return 3;
}

/* Result render */
function calculate(){
  const name=A.name?.trim()||'–î—Ä—É–∑—å—è',kg=goalKg(),rt=rate();
  const wks=Math.max(4,Math.min(16,Math.ceil((A.keep?4:kg)/rt))),t=fSteps().t;
  const dur=fmtDuration(wks);
  $('#rTitle').textContent=`${name}, –≤–∞—à –ø—Ä–æ–≥–Ω–æ–∑ –≥–æ—Ç–æ–≤ ‚ú®`;
  animNum(dur.start,dur.value,1400,v=>{$('#nums').textContent= (A.keep||kg===0) ? `–ß—Ç–æ–±—ã –ø—Ä–∏–π—Ç–∏ –∫ —Ü–µ–ª–∏ –∑–∞ ${v} ${dur.unitText}` : `‚àí${kg} –∫–≥ –∑–∞ ${v} ${dur.unitText}`;});
  const rtText=rt.toLocaleString('ru-RU',{minimumFractionDigits:1,maximumFractionDigits:1});
  $('#rSub').innerHTML = (A.keep||kg===0)
    ? `–°—Ñ–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ <b>—Ç–æ–Ω—É—Å–µ –∏ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏</b>.`
    : `–° —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º–∏ –®–ê–ì–ê–ô –î–û–ú–ê ‚ö°Ô∏è –≤—ã –±—É–¥–µ—Ç–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å <b>${t.toLocaleString('ru-RU')}</b> —à–∞–≥–æ–≤ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å!<br><span class="hint">–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–π —Ç–µ–º–ø: <b>~${rtText} –∫–≥/–Ω–µ–¥–µ–ª—é</b>.</span>`;

  // –ø—Ä–∏–º–µ—Ä –∏–∑ –∫–ª—É–±–∞
  const caseObj=pickCase(Math.round(kg)); renderCaseBox(caseObj);

  // —Ç–µ–∫—Å—Ç –Ω–∞ —Ñ–∏–Ω–∞–ª–µ/–ø—Ä–æ–¥–∞–∂–µ
  const durLabel=dur.label;
  const leadSale=(A.keep||kg===0)
    ? `–ß—Ç–æ–±—ã –ø—Ä–∏–π—Ç–∏ –∫ —Ü–µ–ª–∏ –∑–∞ <b>${durLabel}</b> ‚Äî –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–µ –ø–ª–∞–Ω—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É.`
    : `–ß—Ç–æ–±—ã –ø—Ä–∏–π—Ç–∏ –∫ —Ü–µ–ª–∏ <b>‚àí${kg} –∫–≥</b> –∑–∞ <b>${durLabel}</b> ‚Äî –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–µ –ø–ª–∞–Ω—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É.`;
  $('#sTitle').textContent=`${name}, –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –∫–ª—É–±—É ¬´–®–ê–ì–ê–ô –î–û–ú–ê¬ª ‚ö°`;
  $('#sLead').innerHTML=leadSale;

  // –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω–ª–∞–π–Ω-–æ—Ñ—Ñ–µ—Ä –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–∞–π–º–µ—Ä
  $('#offerInline').style.display='block';
  startTimers();
  show(idxBy('result'))
}
function animNum(a,b,d,cb){
  const s=performance.now(),ease=t=>1-Math.pow(1-t,3);
  function fr(n){const p=Math.min(1,(n-s)/d);cb(Math.round(a+(b-a)*ease(p)));if(p<1)requestAnimationFrame(fr)}
  requestAnimationFrame(fr)
}
function renderCaseBox(c){
  const box=$('#caseBox'); if(!c){box.classList.add('hide'); return;}
  box.classList.remove('hide');
  box.innerHTML=`<img src="${c.img}" alt="–ö–µ–π—Å ${c.name}"><div><h3>–ö–µ–π—Å ${c.name}</h3><p>–ú–∏–Ω—É—Å ${c.kg} –∫–≥ –∑–∞ ${c.months} –º–µ—Å. –ü—Ä–∏–º–µ—Ä —Ç–æ–≥–æ, –∫–∞–∫ —à–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏.</p></div>`;
  box.onclick=()=>openLightbox(c.img, `–ö–µ–π—Å ${c.name}: ‚àí${c.kg} –∫–≥`);
}
function openLightbox(src,cap){$('#lbImg').src=src;$('#lbCap').textContent=cap;$('#lightbox').classList.add('show')}
$('#lbClose').onclick=()=>$('#lightbox').classList.remove('show');

/* ====== Timers (15:00) ====== */
function startCountdown(el, key){
  const now=Date.now();
  const stored=+localStorage.getItem(key)||0;
  let end = (stored && stored>now) ? stored : now + 15*60*1000;
  localStorage.setItem(key, end);
  function tick(){
    const left=end - Date.now();
    if(left<=0){ el.textContent='00:00'; return; }
    const m=Math.floor(left/60000), s=Math.floor((left%60000)/1000);
    el.textContent=String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
    requestAnimationFrame(tick);
  }
  tick();
}
function startTimers(){
  const inl=$('#inlineTimer'); if(inl) startCountdown(inl,'sdq_inline_deadline');
  const sale=$('#saleTimer'); if(sale) startCountdown(sale,'sdq_sale_deadline');
}

/* ====== Flow bindings ====== */
$('#calc')?.addEventListener('click',()=>{ show(idxBy('trial')); });
$('#goForecast')?.addEventListener('click',()=>{ show(idxBy('loading')); runLoading(()=>{ try{ calculate(); } catch(e){ console.error(e); fallbackResult(); } }); });

$('#toPrograms')?.addEventListener('click',()=>show(idxBy('program')));
$('#toCTA')?.addEventListener('click',()=>show(idxBy('program')));
$('#toSale')?.addEventListener('click',()=>{ show(idxBy('sale')); startTimers(); });

/* –ø—Ä–æ–≥—Ä—É–∑–∫–∞ HERO */
document.querySelector('.hero-media')?.addEventListener('loadeddata',()=>$('#heroSkel')?.classList.add('hide'));

/* init discounts and progress on first screen */
updateDiscount(); updateDiscountVisibility();
</script>
</body>
</html>
