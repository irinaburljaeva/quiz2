<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ö–≤–∏–∑ ‚Ä¢ –®–ê–ì–ê–ô –î–û–ú–ê ‚ö°</title>
<meta name="color-scheme" content="light only"/>
<style>
:root{--r:#cf2c02;--o:#e85d04;--y:#ffba08;--g:#e6e6e6;--txt:#111}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--txt);background:#fff}
.hidden{display:none!important}
.app{max-width:960px;margin:0 auto;padding:16px}
.card{background:#fff;border-radius:22px;box-shadow:0 10px 30px rgba(0,0,0,.08);padding:16px}

/* screens */
.screen{display:none;animation:.28s fadeUp ease both}
.screen.is{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
h1{font-size:clamp(22px,5vw,36px);line-height:1.15;margin:8px 0 10px}
h2{font-size:clamp(20px,4.6vw,30px);line-height:1.18;margin:6px 0 12px}
.hint{color:#666}
.grid{display:grid;gap:10px}.cols2{grid-template-columns:1fr 1fr}
@media(max-width:620px){.cols2{grid-template-columns:1fr}}

/* inputs */
.text{width:100%;border:2px solid var(--g);border-radius:12px;padding:12px 14px;font-size:1rem}
.opt{border:2px solid var(--g);border-radius:14px;padding:12px;cursor:pointer;background:#fff}
.opt.is{border-color:var(--o);box-shadow:0 8px 18px rgba(232,93,4,.14)}
.opt--img{display:flex;flex-direction:column;align-items:center;text-align:center}
.opt--img img{width:100%;height:180px;object-fit:contain;background:#fafafa;border-radius:12px}
.opt--img span{margin-top:8px;font-weight:700}
.chips{display:flex;flex-wrap:wrap;gap:8px}
.chip{border:2px solid var(--g);border-radius:999px;padding:9px 12px;background:#fff;cursor:pointer}
.chip.is{border-color:var(--o);box-shadow:0 6px 16px rgba(232,93,4,.12)}
.actions{display:flex;gap:8px;margin-top:12px}
.btn{border:none;border-radius:12px;padding:12px 16px;font-weight:800;cursor:pointer}
.primary{background:linear-gradient(135deg,var(--r),var(--o));color:#fff;box-shadow:0 10px 18px rgba(207,44,2,.25)}
.ghost{background:#fff;border:2px solid var(--g)}
.sticky{position:sticky;bottom:0;background:linear-gradient(0deg,#fff 60%, rgba(255,255,255,0));padding-top:8px;z-index:5}

/* discount header */
#progress{display:flex;align-items:center;gap:10px;margin:0 0 12px}
#progress.hide{display:none!important}
.discbox{display:flex;align-items:center;gap:10px;border:2px solid #ffd7c7;background:#fff7ef;border-radius:14px;padding:8px 12px}
.discbox .title{font-weight:800}
.discbox .value{font-weight:900;font-size:1.15rem}
.disc-tip{position:relative;width:18px;height:18px;border-radius:50%;display:grid;place-items:center;background:var(--y);font-weight:800}
.disc-tip .tt{position:absolute;left:50%;bottom:140%;transform:translateX(-50%);background:#111;color:#fff;padding:6px 8px;border-radius:8px;font-size:.84rem;white-space:nowrap;opacity:0;pointer-events:none}
.disc-tip:hover .tt{opacity:1}

/* slider steps */
#steps{--pct:0%;width:100%;height:40px;background:transparent}
#steps::-webkit-slider-runnable-track{height:12px;border-radius:999px;background:linear-gradient(90deg,var(--o) 0 var(--pct),#eee var(--pct))}
#steps::-webkit-slider-thumb{-webkit-appearance:none;width:28px;height:28px;border:3px solid var(--o);background:#fff;border-radius:50%;margin-top:-8px}

/* goal */
.goal-badge{display:inline-block;padding:4px 8px;border-radius:999px;font-weight:700;font-size:.85rem}
.goal-soft{background:#e8f7ee;color:#0d7d46}
.goal-mid{background:#fff3cc;color:#9a6b00}
.goal-hard{background:#ffe9e6;color:#a11000}
.goal-figure{display:block;max-width:420px;width:100%;border-radius:14px}

/* habits meter */
.habit-meter{border:2px solid var(--g);border-radius:14px;padding:12px}
.hm-track{--p:50%;position:relative;height:12px;border-radius:999px;background:linear-gradient(90deg,#ffe2db 0,#fff8e5 50%,#e6f7ef 100%)}
.hm-pointer{position:absolute;top:50%;left:var(--p);transform:translate(-50%,-50%);width:16px;height:16px;border-radius:50%;background:#fff;border:3px solid var(--o)}
.hm-badge{display:inline-block;padding:4px 8px;border-radius:999px;font-size:.85rem;font-weight:700}

/* HARD cards */
.hcard{border:2px solid var(--g);border-radius:14px;padding:12px;background:#fff;cursor:pointer}
.hcard.is{border-color:var(--o);box-shadow:0 8px 18px rgba(232,93,4,.14)}
.hhead{display:flex;align-items:center;gap:10px;font-weight:700}
.hicon{width:28px;height:28px;display:grid;place-items:center;background:#fff2ec;border:1px solid #ffd5c2;border-radius:999px}

/* deal + timer */
.deal-row{display:flex;align-items:center;gap:10px;justify-content:space-between;flex-wrap:wrap}
.deal-badge{display:inline-block;padding:6px 10px;border-radius:999px;border:2px solid #ffd7c7;background:#fff7ef;font-weight:800}
.deal-timer{font-weight:900;border:2px solid #ddd;border-radius:10px;padding:6px 10px;min-width:72px;text-align:center}

/* player tabs */
.p-tabs{display:flex;gap:8px;margin:6px 0 8px}
.p-btn{border:2px solid #ddd;border-radius:999px;background:#fff;padding:6px 10px;font-weight:700;cursor:pointer}
.p-btn.is{border-color:#ffd7c7;background:#fff7ef}
.player{position:relative;width:100%;aspect-ratio:16/9;border-radius:16px;overflow:hidden;background:#000}
.player iframe{position:absolute;inset:0;width:100%;height:100%;border:0}

/* Program select */
.pgrid{display:grid;gap:12px;grid-template-columns:1fr 1fr}
@media(max-width:760px){.pgrid{grid-template-columns:1fr}}
.pcard{position:relative;border:2px solid var(--g);border-radius:16px;background:#fff;padding:14px}
.pcard.is{border-color:var(--o);box-shadow:0 10px 24px rgba(232,93,4,.18);background:linear-gradient(180deg,#fff,#fff9f3)}
.pcard h3{margin:0 0 4px}
.pcard .tag{display:inline-block;border:1px solid #ffd7c7;background:#fff7ef;border-radius:999px;padding:4px 8px;font-weight:700;margin-right:6px}
.pcard .meta{color:#555;font-size:.92rem}
.pcard .rec{position:absolute;top:10px;right:10px;background:#12a06a;color:#fff;border-radius:999px;padding:4px 8px;font-weight:800;font-size:.82rem}

/* week */
.week-grid{display:grid;gap:10px;grid-template-columns:repeat(7,1fr)}
@media(max-width:840px){.week-grid{grid-template-columns:repeat(4,1fr)}}
@media(max-width:540px){.week-grid{grid-template-columns:repeat(2,1fr)}}
.day{border:2px solid var(--g);border-radius:14px;padding:10px;background:#fff}
.badge{display:inline-block;padding:4px 8px;border-radius:999px;font-size:.8rem;font-weight:700}
.badge-tr{background:#fff2ec;color:#b34009;border:1px solid #ffd5c2}
.badge-rest{background:#eef8f3;color:#0f7a42;border:1px solid #cfeee0}

/* hero / images */
.hero{margin:0 0 12px;border-radius:18px;overflow:hidden;box-shadow:0 10px 18px rgba(0,0,0,.08)}
.hero video,.hero img{display:block;width:100%;height:auto}
.promo-hero{margin:0;border-radius:16px;overflow:hidden;box-shadow:0 10px 22px rgba(0,0,0,.06)}
.promo-hero img{display:block;width:100%;height:auto}

/* responsive chart */
#chartFig img{max-width:min(520px,100%);height:auto;display:block;margin:0 auto}
</style>
</head>
<body>
<div class="app"><div class="card">
  <!-- –°–∫–∏–¥–∫–∞ –≤ —à–∞–ø–∫–µ (—Å–æ 2-–≥–æ –≤–æ–ø—Ä–æ—Å–∞) -->
  <div id="progress" class="hide">
    <div class="discbox">
      <span class="title">–í–∞—à–∞ —Å–∫–∏–¥–∫–∞</span>
      <span class="value" id="discVal">0%</span>
      <span class="disc-tip">i<span class="tt">–†–∞—Å—Ç—ë—Ç —Å –∫–∞–∂–¥—ã–º –≤–æ–ø—Ä–æ—Å–æ–º!</span></span>
    </div>
    <div style="margin-left:auto"><img src="logo.png" alt="–®–ê–ì–ê–ô –î–û–ú–ê" style="height:32px"></div>
  </div>

  <div id="screens"></div>
</div></div>

<script>
/* ========= Helpers & State ========= */
const $=s=>document.querySelector(s), $$=(s,r)=>Array.from((r||document).querySelectorAll(s));
const clamp=(n,a,b)=>Math.max(a,Math.min(b,n));
let A=JSON.parse(localStorage.getItem('sdq')||'{}'); const save=()=>localStorage.setItem('sdq',JSON.stringify(A));

/* ========= Screens Builder ========= */
const S=$("#screens");
const section=(id,html)=>`<section class="screen${id==='intro'?' is':''}" data-id="${id}">${html}</section>`;
const opts=(id,arr)=>`<div class="grid cols2" id="${id}">${arr.map(v=>`<label class="opt" data-v="${v}">${v}</label>`).join('')}</div>`;
const chips=(id,arr)=>`<div class="chips" id="${id}">${arr.map(v=>`<button type="button" class="chip" data-v="${v}">${v}</button>`).join('')}</div>`;
const actions=()=>`<div class="actions sticky"><button class="btn ghost" data-prev type="button">–ù–∞–∑–∞–¥</button><button class="btn primary" data-next type="button">–î–∞–ª–µ–µ</button></div>`;

/* ========= Flow HTML ========= */
const html =
section('intro',`
  <figure class="hero"><video autoplay muted playsinline loop preload="metadata" poster="logo.png"><source src="intro.mp4#t=0.1" type="video/mp4"></video></figure>
  <h1><b>–ü—Ä–æ–π–¥–∏—Ç–µ –∫–≤–∏–∑, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –ø–æ–ª—É—á–∏—Ç—Å—è –ª–∏ —É –≤–∞—Å –ø–æ—Ö—É–¥–µ—Ç—å –Ω–∞ —à–∞–≥–∞—Ö</b></h1>
  <p class="hint"><b>‚Ä¶–∞ —Ç–∞–∫–∂–µ –ø–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—É—é –ø—Ä–æ–±–Ω—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –∏ —Å–∫–∏–¥–∫—É 70% –Ω–∞ –Ω–∞—à–∏ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã!</b></p>
  <div class="grid"><div><div class="hint">–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?</div><input id="name" class="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò—Ä–∏–Ω–∞"></div></div>
  <div class="actions sticky"><button class="btn primary" id="start" type="button">–ü–æ–µ—Ö–∞–ª–∏ ‚Üí</button></div>
`)
+section('age',`<h2>–í–∞—à –≤–æ–∑—Ä–∞—Å—Ç</h2>${opts('ageOpts',['18‚Äì29','30‚Äì39','40‚Äì49','50+'])}${actions()}`)
+section('promo1',`
  <figure class="promo-hero"><img src="2.jpg" alt="–ë–æ–ª—å—à–µ 1 –º–ª–Ω –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤"></figure>
  <h2>–£ –®–ê–ì–ê–ô –î–û–ú–ê‚ö° —É–∂–µ –±–æ–ª—å—à–µ <b>1&nbsp;–º–∏–ª–ª–∏–æ–Ω–∞</b> –ø–æ–¥–ø–∏—Å—á–∏–∫–∞ –≤–æ –≤—Å–µ—Ö —Å–æ—Ü—Å–µ—Ç—è—Ö!</h2>
  <p class="hint">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ —Å–∞–º–æ–º—É –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–º—É —Ñ–∏—Ç–Ω–µ—Å-—Å–æ–æ–±—â–µ—Å—Ç–≤—É.</p>
  ${actions()}
`)
+section('body',`
  <h2>–¢–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏–µ —Å–µ–π—á–∞—Å</h2>
  <div class="grid cols2" id="bodyOpts">
    ${[{k:'slim',t:'–•—É–¥–æ—â–∞–≤–æ–µ',img:'skinny.png'},{k:'avg',t:'–°—Ä–µ–¥–Ω–µ–µ',img:'slim.png'},{k:'large',t:'–ö—Ä—É–ø–Ω–æ–µ',img:'medium.png'},{k:'obese',t:'–ò–∑–±—ã—Ç–æ—á–Ω—ã–π –≤–µ—Å',img:'xl.png'}].map(o=>`<label class="opt opt--img" data-v="${o.k}"><img src="${o.img}" alt=""><span>${o.t}</span></label>`).join('')}
  </div>
  ${actions()}
`)
+section('promo2',`
  <figure class="promo-hero"><img src="otzyv.jpg" alt="–£–∂–µ –±–æ–ª—å—à–µ 10 000 –ª—é–¥–µ–π –≤ –∫–ª—É–±–µ"></figure>
  <h2>–£–∂–µ –±–æ–ª—å—à–µ <b>10&nbsp;000</b> –ª—é–¥–µ–π –≤ –∫–ª—É–±–µ –®–ê–ì–ê–ô –î–û–ú–ê ‚ö°</h2>
  <p class="hint">–ö–∞–∂–¥—ã–π –Ω–∞ —Å–≤–æ—ë–º —É—Ä–æ–≤–Ω–µ, –Ω–æ –≤–º–µ—Å—Ç–µ ‚Äî —Å–∏–ª—å–Ω–µ–µ.</p>
  ${actions()}
`)
+section('steps',`
  <h2>–°–∫–æ–ª—å–∫–æ —à–∞–≥–æ–≤ –≤—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç–µ —Å–µ–π—á–∞—Å –≤ –¥–µ–Ω—å?</h2>
  <input id="steps" type="range" min="0" max="25000" step="250" value="4000">
  <div class="hint">–°–µ–π—á–∞—Å: <b><span id="sv">4000</span> —à–∞–≥–æ–≤</b></div>
  ${actions()}
`)
+section('bmi',`
  <h2>–î–∞–≤–∞–π—Ç–µ –ø–æ—Å—á–∏—Ç–∞–µ–º –≤–∞—à –ò–ú–¢</h2>
  <div class="grid cols2">
    <div><div class="hint">–†–æ—Å—Ç, —Å–º</div><input id="h" type="number" class="text" inputmode="numeric"></div>
    <div><div class="hint">–í–µ—Å, –∫–≥</div><input id="w" type="number" class="text" inputmode="numeric"></div>
  </div>
  <div id="bmiI" class="hint" style="margin-top:8px"></div>
  <details style="margin-top:8px"><summary>–ß—Ç–æ —Ç–∞–∫–æ–µ –ò–ú–¢?</summary><div class="hint">–ò–Ω–¥–µ–∫—Å –º–∞—Å—Å—ã —Ç–µ–ª–∞ ‚Äî –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –º–∞—Å—Å—ã –∏ —Ä–æ—Å—Ç–∞. –ù–æ—Ä–º–∞: 18.5‚Äì24.9, –∏–∑–±—ã—Ç–æ—á–Ω–∞—è –º–∞—Å—Å–∞: 25‚Äì29.9, –æ–∂–∏—Ä–µ–Ω–∏–µ: 30+.</div></details>
  ${actions()}
`)
+section('life',`<h2>–û–±—Ä–∞–∑ –∂–∏–∑–Ω–∏</h2>${opts('lifeOpts',['–°–∏–¥—è—á–∞—è —Ä–∞–±–æ—Ç–∞','–£–º–µ—Ä–µ–Ω–Ω–æ –∞–∫—Ç–∏–≤–Ω–∞—è','–ê–∫—Ç–∏–≤–Ω–∞—è'])}${actions()}`)
+section('exp',`<h2>–û–ø—ã—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h2>${opts('expOpts',['–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–Ω–∏–º–∞–ª–∞—Å—å','–ò–Ω–æ–≥–¥–∞ –¥–æ–º–∞ / –ø–æ –≤–∏–¥–µ–æ','–†–µ–≥—É–ª—è—Ä–Ω–æ'])}${actions()}`)
+section('promo3',`
  <figure class="promo-hero"><img src="walkwalk.jpg" alt="20 –º–ª–Ω —à–∞–≥–æ–≤ –≤ –¥–µ–Ω—å"></figure>
  <h2><b>20&nbsp;–º–∏–ª–ª–∏–æ–Ω–æ–≤</b> —à–∞–≥–æ–≤ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–∞–±–∏—Ä–∞—é—Ç —É—á–∞—Å—Ç–Ω–∏—Ü—ã –∫–ª—É–±–∞ üòç</h2>
  <p class="hint">–ö–æ—Ä–æ—Ç–∫–∏–µ —à–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ª–µ–≥–∫–æ –≤–ø–∏—Å–∞—Ç—å –≤ –¥–µ–Ω—å.</p>
  ${actions()}
`)
+section('goal',`
  <h2>–í–∞—à–∞ —Ü–µ–ª—å</h2>
  <div class="grid cols2">
    <div>
      <label><input id="goalKeep" type="checkbox"> <b>–ù–∞–∫–∞—á–∞—Ç—å –º—ã—à—Ü—ã / –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ñ–æ—Ä–º—É</b></label>
      <div class="hint" style="margin:6px 0">–ï—Å–ª–∏ —Ü–µ–ª—å ‚Äî –Ω–µ —Ö—É–¥–µ—Ç—å, –æ—Ç–º–µ—Ç—å—Ç–µ —ç—Ç–æ—Ç –ø—É–Ω–∫—Ç.</div>
      <div style="margin:10px 0"><span>–°–∫–∏–Ω—É—Ç—å (–∫–≥): </span><input id="goalRange" type="range" min="0" max="20" step="0.5" value="5"><b> <span id="goalVal">5.0</span> –∫–≥</b></div>
      <div class="hint">–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ü–µ–ª–∏: <span id="goalBadge" class="goal-badge goal-mid">—É–º–µ—Ä–µ–Ω–Ω–æ</span></div>
    </div>
    <div><img class="goal-figure" src="doposle.jpg" alt="–¶–µ–ª—å –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç"></div>
  </div>
  ${actions()}
`)
+section('perweek',`
  <h2>–°–∫–æ–ª—å–∫–æ –≥–æ—Ç–æ–≤—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –Ω–µ–¥–µ–ª—é?</h2>
  ${chips('pwChips',['2 —Ä–∞–∑–∞','3 —Ä–∞–∑–∞','4‚Äì5 —Ä–∞–∑','–ö–∞–∂–¥—ã–π –¥–µ–Ω—å 20‚Äì30 –º–∏–Ω'])}
  <div id="aha" class="hidden" style="margin-top:8px"></div>
  <figure id="chartFig" class="hidden" style="margin:6px 0 0"><img src="chart.jpg" alt="–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞"></figure>
  ${actions()}
`)
+section('promo4',`
  <figure class="promo-hero"><img src="doposle.jpg" alt="85% –ø–æ—Ö—É–¥–µ–ª–∏ –Ω–∞ 1‚Äì2 –∫–≥"></figure>
  <h2><b>85%</b> –∫–ª—É–±–Ω–∏–∫–æ–≤ –ø–æ—Ö—É–¥–µ–ª–∏ –Ω–∞ <b>1‚Äì2&nbsp;–∫–≥</b> –∑–∞ –ø–µ—Ä–≤—É—é –Ω–µ–¥–µ–ª—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ üî•</h2>
  <p class="hint">–†–µ–∑—É–ª—å—Ç–∞—Ç –º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å.</p>
  ${actions()}
`)
+section('hard',`
  <h2>–ß—Ç–æ —Å–µ–π—á–∞—Å –¥–∞—ë—Ç—Å—è —Ç—è–∂–µ–ª–µ–µ –≤—Å–µ–≥–æ?</h2>
  <div class="grid cols2" id="hardCards">
    <div class="hcard" data-k="walk"><div class="hhead"><div class="hicon">üö∂‚Äç‚ôÄÔ∏è</div><div>–î–æ–ª–≥–∞—è –ø—Ä–æ–≥—É–ª–∫–∞ —É—Ç–æ–º–ª—è–µ—Ç</div></div></div>
    <div class="hcard" data-k="stairs"><div class="hhead"><div class="hicon">ü™ú</div><div>–õ–µ—Å—Ç–Ω–∏—Ü—ã ‚Äî –∏—Å–ø—ã—Ç–∞–Ω–∏–µ</div></div></div>
    <div class="hcard" data-k="games"><div class="hhead"><div class="hicon">üéØ</div><div>–ê–∫—Ç–∏–≤–Ω—ã–µ –∏–≥—Ä—ã</div></div></div>
    <div class="hcard" data-k="jumps"><div class="hhead"><div class="hicon">ü¶ò</div><div>–ü—Ä—ã–∂–∫–∏</div></div></div>
    <div class="hcard" data-k="none"><div class="hhead"><div class="hicon">‚úÖ</div><div>–ù–∏—á–µ–≥–æ –∏–∑ —ç—Ç–æ–≥–æ</div></div></div>
  </div>
  ${actions()}
`)
+section('health',`<h2>–ï—Å—Ç—å –ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –≤–∞–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å?</h2>${chips('healthChips',['–î–∏–∞–±–µ—Ç','–ü—Ä–æ–±–ª–µ–º—ã —Å–æ —â–∏—Ç–æ–≤–∏–¥–∫–æ–π','–ì–∏–ø–µ—Ä—Ç–æ–Ω–∏—è','–ë–æ–ª—å –≤ —Å—É—Å—Ç–∞–≤–∞—Ö','–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å','–ù–µ—Ç'])}${actions()}`)
+section('nutrition',`<h2>–ü–∏—Ç–∞–Ω–∏–µ</h2>${opts('nutriOpts',['–ë—É–¥—É –ø–∏—Ç–∞—Ç—å—Å—è –ø–æ –º–µ–Ω—é-–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—É –≤ –∫–ª—É–±–µ','–•–æ—á—É –Ω–∞—É—á–∏—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å —Ç–∞—Ä–µ–ª–∫—É','–ù–µ—Ç, –ø–æ–∫–∞ –±–µ–∑ –ø–∏—Ç–∞–Ω–∏—è'])}${actions()}`)
+section('food',`
  <h2>–í–∞—à–∏ –ø—Ä–∏–≤—ã—á–∫–∏</h2>
  <div class="chips" id="bad">${['–°–ª–∞–¥–∫–∏–µ –ø–µ—Ä–µ–∫—É—Å—ã','–ü–æ–ª—É—Ñ–∞–±—Ä–∏–∫–∞—Ç—ã','–ù–µ–¥–æ—Å—ã–ø','–ß–∞—Å—Ç—ã–π —Å—Ç—Ä–µ—Å—Å'].map(x=>`<button class="chip" data-kind="bad" data-v="${x}">${x}</button>`).join('')}</div>
  <div class="chips" id="good" style="margin-top:8px">${['1.5‚Äì2 –ª –≤–æ–¥—ã','–û–≤–æ—â–∏ 400 –≥/–¥–µ–Ω—å','–ë–µ–ª–æ–∫ –∏ —Ñ—Ä—É–∫—Ç—ã –≤ –∫–∞–∂–¥–æ–º –ø—Ä–∏—ë–º–µ –ø–∏—â–∏','–°–æ–Ω 7-8 —á–∞—Å–æ–≤'].map(x=>`<button class="chip" data-kind="good" data-v="${x}">${x}</button>`).join('')}</div>
  <div class="habit-meter hidden" id="hmWrap" style="margin-top:10px">
    <div style="display:flex;justify-content:space-between"><div>–ò–Ω–¥–µ–∫—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ <span id="hmBadge" class="hm-badge">–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ</span></div><b id="hmScore">0%</b></div>
    <div class="hm-track" id="hmTrack"><div class="hm-pointer" id="hmPtr"></div></div>
  </div>
  <div class="actions sticky"><button class="btn ghost" data-prev type="button">–ù–∞–∑–∞–¥</button><button class="btn primary" id="toTrial" type="button">–î–∞–ª–µ–µ ‚Üí</button></div>
`)
+section('trial',`
  <h2>–£—Ä–∞! –í—ã –æ—Ç–≤–µ—Ç–∏–ª–∏ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã üéâ</h2>
  <p class="hint"><b>–¢–µ–ø–µ—Ä—å –≤–∞–º –¥–æ—Å—Ç—É–ø–Ω–∞ –ø—Ä–æ–±–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞.</b></p>
  <div class="p-tabs" id="trialTabs"></div>
  <figure style="aspect-ratio:16/9;border-radius:16px;overflow:hidden"><div id="trialFrame" class="player"></div></figure>
  <p class="hint"><b id="trialCtaText">–£–∑–Ω–∞–π—Ç–µ, –Ω–∞ —Å–∫–æ–ª—å–∫–æ –≤—ã –ø–æ—Ö—É–¥–µ–µ—Ç–µ, –µ—Å–ª–∏ –±—É–¥–µ—Ç–µ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –ø–æ —Ç–∞–∫–∏–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º 3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é.</b></p>
  <div class="actions sticky"><button class="btn ghost" data-prev type="button">–ù–∞–∑–∞–¥</button><button class="btn primary" id="calc" type="button">–£–∑–Ω–∞—Ç—å –º–æ–π –ø—Ä–æ–≥–Ω–æ–∑ ‚Üí</button></div>
`)
+section('loading',`
  <div style="text-align:center;padding:34px 0"><div id="lp" style="display:inline-grid;place-items:center;width:96px;height:96px;border-radius:50%;background:conic-gradient(var(--o) 0deg,#eee 0deg)"><div style="width:70px;height:70px;background:#fff;border-radius:50%;display:grid;place-items:center"><b id="lpct">0%</b></div></div><div style="margin-top:12px" id="lmsg">–°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ‚Ä¶</div></div>
`)
+section('result',`
  <h2 id="rTitle">–ì–æ—Ç–æ–≤–æ!</h2>
  <div style="font-size:clamp(24px,6vw,44px);font-weight:900;margin:6px 0" id="nums">0 –∫–≥ –∑–∞ 0 –Ω–µ–¥–µ–ª—å</div>
  <p class="hint" id="rSub"></p>

  <!-- –ü—Ä–∏–º–µ—Ä –∏–∑ –∫–ª—É–±–∞ -->
  <div id="caseBox" class="hidden" style="display:grid;grid-template-columns:120px 1fr;gap:12px;align-items:center;margin:12px 0">
    <img id="caseImg" src="otzyv.jpg" alt="–ü—Ä–∏–º–µ—Ä –∏–∑ –∫–ª—É–±–∞" style="width:120px;height:120px;object-fit:cover;border-radius:12px">
    <div><div style="font-weight:800;margin-bottom:4px">–ü—Ä–∏–º–µ—Ä –∏–∑ –∫–ª—É–±–∞</div><div class="hint" id="caseTxt"></div></div>
  </div>

  <!-- –°–ø–µ—Ü-–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –±–µ–∑ CTA (CTA —Ç–æ–ª—å–∫–æ –≤ —Ñ–∏–Ω–∞–ª–µ) -->
  <div style="margin:10px 0">
    <p class="hint"><b>–¢–æ–ª—å–∫–æ –¥–ª—è –≤–∞—Å —É –Ω–∞—Å –¥–µ–π—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: ‚àí70% –Ω–∞ –≤—Å–µ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã –≤ –∫–ª—É–±!</b></p>
    <div class="deal-row"><span class="deal-badge">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ</span><span class="deal-timer" id="inlineTimer">15:00</span></div>
  </div>

  <div class="actions"><button class="btn ghost" data-prev type="button">–ù–∞–∑–∞–¥</button><button class="btn primary" id="seeProgram" type="button">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É</button></div>
`)
+section('progSelect',`
  <h2>–ü–æ–¥–±–µ—Ä—ë–º –ø—Ä–æ–≥—Ä–∞–º–º—É –ø–æ–¥ –≤–∞—Å</h2>
  <p class="hint">–ú—ã —É—á–ª–∏ –≤–∞—à –≤–æ–∑—Ä–∞—Å—Ç, –ò–ú–¢, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –æ–ø—ã—Ç –∏ —Ü–µ–ª—å. –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π –≤–∞—Ä–∏–∞–Ω—Ç.</p>
  <div class="pgrid" id="progGrid"></div>
  <div class="actions sticky"><button class="btn ghost" data-prev type="button">–ù–∞–∑–∞–¥</button><button class="btn primary" id="goProgram" type="button">–°–º–æ—Ç—Ä–µ—Ç—å –Ω–µ–¥–µ–ª—é ‚Üí</button></div>
`)
+section('program',`
  <h2 id="progTitle">–ü—Ä–∏–º–µ—Ä –≤–∞—à–µ–π –Ω–µ–¥–µ–ª–∏ –≤ –∫–ª—É–±–µ</h2>
  <p class="hint" id="progLead"></p>
  <div class="week-grid" id="weekGrid"></div>
  <div class="actions sticky"><button class="btn ghost" data-prev type="button">–ù–∞–∑–∞–¥</button><button class="btn primary" id="toSale" type="button">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—é!</button></div>
`)
+section('sale',`
  <figure class="promo-hero"><img src="2.jpg" alt="–ö–ª—É–± –®–ê–ì–ê–ô –î–û–ú–ê"></figure>
  <h2>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –∫–ª—É–±—É ¬´–®–ê–ì–ê–ô –î–û–ú–ê¬ª ‚ö°</h2>
  <p class="hint" id="sLead"></p>
  <p class="hint"><b>–¢–æ–ª—å–∫–æ –¥–ª—è –≤–∞—Å —É –Ω–∞—Å –¥–µ–π—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: ‚àí70% –Ω–∞ –≤—Å–µ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã –≤ –∫–ª—É–±!</b></p>
  <div class="deal-row"><span class="deal-badge">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ</span><span class="deal-timer" id="saleTimer">15:00</span></div>
  <div class="actions" style="margin-top:10px"><a class="btn primary" id="cta" target="_blank" rel="noopener" href="https://walk-walk.ru/?utm_source=website&utm_medium=quiz&utm_campaign=looseweight">–•–æ—á—É –∞–±–æ–Ω–µ–º–µ–Ω—Ç —Å–æ —Å–∫–∏–¥–∫–æ–π 70%!</a></div>
`);

S.innerHTML = html;

/* ========= Progress & Navigation ========= */
let idx=0, SECTIONS=$$('.screen');
const progress=$('#progress'), discVal=$('#discVal');
const QUESTION_IDS=['age','body','steps','bmi','life','exp','goal','perweek','hard','health','nutrition','food'];
const idxBy=id=>SECTIONS.findIndex(s=>s.dataset.id===id);

function updateDiscount(){
  let seen=0;
  for(const id of QUESTION_IDS){
    const qi=idxBy(id); if(qi>=0 && idx>=qi) seen++;
  }
  const pct=Math.min(70,Math.round(seen/QUESTION_IDS.length*70));
  discVal.textContent=pct+'%';
}
function show(n){
  SECTIONS[idx].classList.remove('is');
  idx=clamp(n,0,SECTIONS.length-1);
  SECTIONS[idx].classList.add('is');
  // —Å–∫–∏–¥–∫–∞ —Ç–æ–ª—å–∫–æ —Å–æ –≤—Ç–æ—Ä–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ (body)
  progress.classList.toggle('hide', idx < idxBy('body'));
  updateDiscount();
  window.scrollTo({top:0,behavior:'smooth'});
  const id=SECTIONS[idx].dataset.id;
  if(id==='trial') mountTrial();
  if(id==='progSelect') renderProgSelect();
  if(id==='program') renderProgram();
}

$('#start').onclick=()=>show(1);
window.addEventListener('click',e=>{
  if(e.target.closest('[data-next]')) show(idx+1);
  if(e.target.closest('[data-prev]')) show(idx-1);
});
document.addEventListener('click',e=>{
  const id=e.target?.id;
  if(id==='toTrial') show(idxBy('trial'));
  if(id==='calc'){ show(idxBy('loading')); runLoading(calculate); }
  if(id==='seeProgram') show(idxBy('progSelect'));
  if(id==='goProgram') show(idxBy('program'));
  if(id==='toSale') show(idxBy('sale'));
});

/* ========= Inputs ========= */
$('#name').oninput=e=>{A.name=e.target.value.trim();save()};

const stepsRange=$('#steps'), sv=$('#sv');
const updR=()=>{const min=+stepsRange.min,max=+stepsRange.max,val=+stepsRange.value;stepsRange.style.setProperty('--pct',((val-min)/(max-min))*100+'%')};
stepsRange.oninput=e=>{A.steps=+e.target.value;sv.textContent=A.steps;updR();save();updateAha()};
updR();

['h','w'].forEach(id=>{$('#'+id).addEventListener('input',updBMI)});
function bmiCat(b){if(b<18.5)return['–î–µ—Ñ–∏—Ü–∏—Ç –º–∞—Å—Å—ã','goal-soft'];if(b<25)return['–ù–æ—Ä–º–∞','goal-soft'];if(b<30)return['–ò–∑–±—ã—Ç–æ—á–Ω–∞—è –º–∞—Å—Å–∞','goal-mid'];if(b<35)return['–û–∂–∏—Ä–µ–Ω–∏–µ I —Å—Ç.','goal-hard'];if(b<40)return['–û–∂–∏—Ä–µ–Ω–∏–µ II —Å—Ç.','goal-hard'];return['–û–∂–∏—Ä–µ–Ω–∏–µ III —Å—Ç.','goal-hard']}
function updBMI(){
  const h=+$('#h').value,w=+$('#w').value;
  if(h>0&&w>0){
    A.h=h;A.w=w;const m=h/100;A.bmi=+(w/(m*m)).toFixed(1);save();
    const [lbl,cls]=bmiCat(A.bmi);
    $('#bmiI').innerHTML='–í–∞—à –ò–ú–¢: <b>'+A.bmi+'</b> ‚Äî <span class="goal-badge '+cls+'">'+lbl+'</span>';
  }else{$('#bmiI').textContent=''}
}

/* Generic chooser */
function choose(root,key,single){root.addEventListener('click',e=>{const el=e.target.closest(single?'.opt':'.chip');if(!el)return;
  if(single){$$('.opt',root).forEach(x=>x.classList.remove('is'));el.classList.add('is');A[key]=el.dataset.v||el.textContent}
  else{el.classList.toggle('is');A[key]=$$('.chip.is',root).map(x=>x.dataset.v)}
  save(); if(key==='perweek') updateAha();
});}
choose($('#ageOpts'),'age',true);
choose($('#bodyOpts'),'body',true);
choose($('#lifeOpts'),'life',true);
choose($('#expOpts'),'exp',true);
choose($('#pwChips'),'perweek',false);
choose($('#healthChips'),'health',false);
choose($('#nutriOpts'),'nutri',true);

/* ========= HARD question ========= */
(function(){
  const wrap=$('#hardCards'); const map={walk:'–î–æ–ª–≥–∞—è –ø—Ä–æ–≥—É–ª–∫–∞ —É—Ç–æ–º–ª—è–µ—Ç',stairs:'–õ–µ—Å—Ç–Ω–∏—Ü—ã ‚Äî –∏—Å–ø—ã—Ç–∞–Ω–∏–µ',games:'–ê–∫—Ç–∏–≤–Ω—ã–µ –∏–≥—Ä—ã',jumps:'–ü—Ä—ã–∂–∫–∏',none:'–ù–∏—á–µ–≥–æ –∏–∑ —ç—Ç–æ–≥–æ'};
  if(A.hardKey){const sel=wrap.querySelector(`[data-k="${A.hardKey}"]`); if(sel) sel.classList.add('is')}
  wrap.addEventListener('click',e=>{
    const c=e.target.closest('.hcard'); if(!c) return;
    $$('.hcard',wrap).forEach(x=>x.classList.remove('is'));
    c.classList.add('is'); A.hardKey=c.dataset.k; A.hard=map[A.hardKey]; save();
  });
})();

/* ========= Goal ========= */
const goalR=$('#goalRange'), goalV=$('#goalVal'), goalB=$('#goalBadge'), goalKeep=$('#goalKeep');
function setGoal(v){v=clamp(+v||0,0,20);A.goalKg=v;goalV.textContent=v.toFixed(1);const cls=v===0?'goal-soft':v<=10?'goal-mid':'goal-hard';const txt=v===0?'–ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ':v<=10?'—É–º–µ—Ä–µ–Ω–Ω–æ':'–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ';goalB.className='goal-badge '+cls;goalB.textContent=txt;save()}
goalR.oninput=e=>setGoal(e.target.value);
goalKeep.onchange=e=>{A.keep=!!e.target.checked;save();if(A.keep){setGoal(0);goalR.disabled=true}else{goalR.disabled=false;if((+A.goalKg||0)===0)setGoal(5)}};
(function(){const kg=(A.goalKg!=null)?A.goalKg:5;goalR.value=kg;setGoal(kg);goalKeep.checked=!!A.keep;goalR.disabled=!!A.keep})();

/* ========= Per week & Chart reveal ========= */
function freqFromPerweek(){const s=A.perweek||[];let n=0;if(s.some(v=>/–ö–∞–∂–¥—ã–π –¥–µ–Ω—å/.test(v)))n=7;else if(s.some(v=>/4‚Äì5/.test(v)))n=5;else if(s.some(v=>/3/.test(v)))n=3;else if(s.some(v=>/2/.test(v)))n=2;return n}
function perweekLabel(){const s=freqFromPerweek();return s===7?'–∫–∞–∂–¥—ã–π –¥–µ–Ω—å':s===5?'4‚Äì5 —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é':s===3?'3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é':s===2?'2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é':'3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é'}
function updateAha(){const n=freqFromPerweek(), box=$('#aha'), fig=$('#chartFig'); if(!n){box.classList.add('hidden');box.innerHTML='';fig.classList.add('hidden');return}
 const add=n*3000, base=(+A.steps||4000)*7, k=base?Math.min(2.5,Math.max(1.1,(base+add)/base)):1.3;
 box.innerHTML='<b>–û—Ç–ª–∏—á–Ω–æ!</b> –° —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º–∏ '+(n===7?'–∫–∞–∂–¥—ã–π –¥–µ–Ω—å':'~'+n+' —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é')+' –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤—ã—Ä–∞—Å—Ç–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ <b>'+k.toFixed(1)+' —Ä–∞–∑–∞</b> (–µ—â—ë ~'+add.toLocaleString('ru-RU')+' —à–∞–≥–æ–≤/–Ω–µ–¥).';
 box.classList.remove('hidden'); fig.classList.remove('hidden');
}

/* ========= Habits Index ========= */
(function habits(){
  const wrapBad=$('#bad'), wrapGood=$('#good'), hmWrap=$('#hmWrap'), ptr=$('#hmPtr'), scoreEl=$('#hmScore'), badge=$('#hmBadge');
  function recompute(){
    const bad=$$('.chip.is',wrapBad).length, good=$$('.chip.is',wrapGood).length;
    A.badHabits=$$('.chip.is',wrapBad).map(x=>x.dataset.v);
    A.goodHabits=$$('.chip.is',wrapGood).map(x=>x.dataset.v);
    save();
    let score = clamp(Math.round(50 + good*12 - bad*12),0,100);
    scoreEl.textContent=score+'%';
    ptr.style.left = score+'%';
    hmWrap.classList.toggle('hidden', (bad+good)===0);
    badge.textContent = score<40?'—Å—Ç–∞—Ä—Ç':(score>=60?'–º–æ–ª–æ–¥–µ—Ü!':'–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ');
  }
  function toggle(e){const b=e.target.closest('.chip'); if(!b) return; b.classList.toggle('is'); recompute();}
  wrapBad.addEventListener('click',toggle);
  wrapGood.addEventListener('click',toggle);
  // restore
  (A.badHabits||[]).forEach(v=>{const el=wrapBad.querySelector(`[data-v="${v}"]`); el&&el.classList.add('is')});
  (A.goodHabits||[]).forEach(v=>{const el=wrapGood.querySelector(`[data-v="${v}"]`); el&&el.classList.add('is')});
  recompute();
})();

/* ========= Trial Player ========= */
const EMBEDS={
  vk:'https://vk.com/video_ext.php?oid=-222534261&id=456239990&hd=2',
  yt:'https://www.youtube-nocookie.com/embed/TFltKZJoV2g?rel=0&modestbranding=1',
  rt:'https://rutube.ru/play/embed/fbad797705787d6048d2344b7aa55a90?r=a&p=93p6xGkyvbtXxF38SzuoSw'
};
function mountTrial(){
  const tabs=$('#trialTabs'), frame=$('#trialFrame');
  tabs.innerHTML=['vk','yt','rt'].map((k,i)=>`<button class="p-btn${i?'':' is'}" data-k="${k}">${{vk:'VK –í–∏–¥–µ–æ',yt:'YouTube',rt:'RuTube'}[k]}</button>`).join('');
  function sel(k){tabs.querySelectorAll('.p-btn').forEach(b=>b.classList.toggle('is',b.dataset.k===k));frame.innerHTML=`<iframe src="${EMBEDS[k]}" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>`}
  tabs.onclick=e=>{const b=e.target.closest('.p-btn'); if(b) sel(b.dataset.k)};
  sel('vk');
  $('#trialCtaText').innerHTML = `<b>–£–∑–Ω–∞–π—Ç–µ, –Ω–∞ —Å–∫–æ–ª—å–∫–æ –≤—ã –ø–æ—Ö—É–¥–µ–µ—Ç–µ, –µ—Å–ª–∏ –±—É–¥–µ—Ç–µ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –ø–æ —Ç–∞–∫–∏–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º ${perweekLabel()}.</b>`;
}

/* ========= Loading Ring ========= */
function runLoading(done){
  const lp=$('#lp'),pct=$('#lpct'),msg=$('#lmsg');const T=1500,t0=performance.now();
  const steps=['–í–æ–∑—Ä–∞—Å—Ç –∏ –ò–ú–¢','–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –æ–ø—ã—Ç','–¶–µ–ª—å –∏ –ø–∏—Ç–∞–Ω–∏–µ','–ì–æ—Ç–æ–≤–∏–º –ø—Ä–æ–≥–Ω–æ–∑‚Ä¶'];
  requestAnimationFrame(function tick(t){const p=Math.min(1,(t-t0)/T);pct.textContent=Math.round(5+95*(1-Math.pow(1-p,3)))+'%';msg.textContent=steps[Math.min(steps.length-1,Math.floor(p*steps.length))];lp.style.background=`conic-gradient(var(--o) ${Math.round(p*360)}deg,#eee 0)`;if(p<1)requestAnimationFrame(tick);else setTimeout(done,200)})
}

/* ========= Calculation Helpers ========= */
function fLife(){return /–ê–∫—Ç–∏–≤–Ω–∞—è/.test(A.life||'')?1.08:/–°–∏–¥—è—á–∞—è/.test(A.life||'')?0.9:1.0}
function fExp(){return /–†–µ–≥—É–ª—è—Ä–Ω–æ/.test(A.exp||'')?1.08:/–ù–∏–∫–æ–≥–¥–∞/.test(A.exp||'')?0.95:1.0}
function fBody(){return {slim:.92,avg:1,large:.96,obese:.92}[A.body||'avg']||1}
function fSteps(){const now=+A.steps||4000;let b=1+2000/10000;if(now<3000)b+=.08;if(now>9000)b-=.06;return clamp(b,.95,1.28)}
function rate(){let r=.5;const bmi=A.bmi||26;if(bmi>=30)r+=.08;else if(bmi<23)r-=.08;r*=fLife()*fExp()*fBody()*fSteps();return clamp(+r.toFixed(2),.25,.9)}
function fmtDur(w){return w<=10?{v:w,u:'–Ω–µ–¥–µ–ª—å'}:{v:Math.ceil(w/4),u:'–º–µ—Å.'}}
function goalKg(){if(A.keep)return 0;return A.goalKg!=null?+A.goalKg:5}

/* ========= Case block (example) ========= */
function renderCase(kg,keep){
  const box=$('#caseBox'), txt=$('#caseTxt'), img=$('#caseImg');
  if(keep){txt.innerHTML='–ï–ª–µ–Ω–∞, 41 –≥–æ–¥: ¬´–ß–µ—Ä–µ–∑ 6 –Ω–µ–¥–µ–ª—å —Å—Ç–∞–ª–∞ –≤—ã–Ω–æ—Å–ª–∏–≤–µ–µ, —É—à–ª–∏ –æ—Ç—ë–∫–∏, –æ–±—ä—ë–º—ã ‚àí4 —Å–º –ø–æ —Ç–∞–ª–∏–∏.¬ª'; img.src='otzyv.jpg'; box.classList.remove('hidden'); return;}
  if(kg>=8){txt.innerHTML='–ú–∞—Ä–∏–Ω–∞, 34 –≥–æ–¥–∞: ‚àí9.2 –∫–≥ –∑–∞ 12 –Ω–µ–¥–µ–ª—å –Ω–∞ —à–∞–≥–∞—Ö –∏ –ø—Ä–æ—Å—Ç–æ–º –ø–∏—Ç–∞–Ω–∏–∏ –∏–∑ –∫–ª—É–±–∞.'; img.src='doposle.jpg'}
  else if(kg>=4){txt.innerHTML='–ê–ª—ë–Ω–∞, 29 –ª–µ—Ç: ‚àí5.1 –∫–≥ –∑–∞ 8 –Ω–µ–¥–µ–ª—å, —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ 3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é.'; img.src='otzyv.jpg'}
  else{txt.innerHTML='–ù–∞—Ç–∞–ª—å—è, 47 –ª–µ—Ç: ‚àí2.3 –∫–≥ –∑–∞ 4 –Ω–µ–¥–µ–ª–∏, —Å–æ–Ω –∏ –≤–æ–¥–∞ –ø–æ –ø–ª–∞–Ω—É + —à–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ.'; img.src='otzyv.jpg'}
  box.classList.remove('hidden');
}

/* ========= Calculate & Show Result ========= */
function calculate(){
  const name=A.name?.trim()||'–î—Ä—É–∑—å—è'; const keep=!!A.keep; const kg=goalKg(); const r=rate(); const w=Math.max(4,Math.min(16,Math.ceil((keep?4:kg)/r))); const d=fmtDur(w);
  $('#rTitle').textContent=`${name}, –≤–∞—à –ø—Ä–æ–≥–Ω–æ–∑ –≥–æ—Ç–æ–≤ ‚ú®`;
  if(keep||kg===0){
    $('#nums').textContent=`–ß—Ç–æ–±—ã –ø—Ä–∏–π—Ç–∏ –∫ —Ü–µ–ª–∏ –∑–∞ ${d.v} ${d.u}`;
    $('#rSub').innerHTML=`–°—Ñ–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ <b>—Ç–æ–Ω—É—Å–µ –∏ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏</b>.`;
  }else{
    $('#nums').textContent=`‚àí${kg} –∫–≥ –∑–∞ ${d.v} ${d.u}`;
    $('#rSub').innerHTML=`–° –®–ê–ì–ê–ô –î–û–ú–ê ‚ö° –≤—ã –±—É–¥–µ—Ç–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å <b>${(+A.steps+2000).toLocaleString('ru-RU')}</b> —à–∞–≥–æ–≤ –≤ –¥–µ–Ω—å.`;
  }
  renderCase(kg,keep);
  startTimers();
  A.recKeys = chooseProgramKeys(); save();
  $('#sLead').innerHTML = keep? '–ì–æ—Ç–æ–≤—ã–µ –ø–ª–∞–Ω—ã –Ω–∞ —Ç–æ–Ω—É—Å –∏ –º—ã—à—Ü—ã, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –ø–æ–º–æ–≥—É—Ç –≤–∞–º –¥–µ—Ä–∂–∞—Ç—å —Ä–∏—Ç–º.' : `–ß—Ç–æ–±—ã –ø—Ä–∏–π—Ç–∏ –∫ —Ü–µ–ª–∏ <b>‚àí${kg} –∫–≥</b> ‚Äî –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–µ –ø–ª–∞–Ω—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É.`;
  show(idxBy('result'));
}

/* ========= 15-–º–∏–Ω —Ç–∞–π–º–µ—Ä—ã ========= */
function getDeadline(){let t=+localStorage.getItem('sdq_offer_deadline15')||0;const now=Date.now();if(!t||t<now){t=now+15*60*1000;localStorage.setItem('sdq_offer_deadline15',String(t))}return t}
function fmt(ms){let s=Math.max(0,Math.floor(ms/1000)),m=Math.floor(s/60);s%=60;return String(m).padStart(2,'0')+':'+String(s).padStart(2,'0')}
let timerI=null;function startTimers(){if(timerI)clearInterval(timerI);const dl=getDeadline();const t1=$('#inlineTimer'),t2=$('#saleTimer');function tick(){const left=dl-Date.now();const v=fmt(left);t1&&(t1.textContent=v);t2&&(t2.textContent=v);if(left<=0)clearInterval(timerI)}tick();timerI=setInterval(tick,1000)}

/* ========= Catalog & Program ========= */
const CATALOG={
  /* –®–ê–ì–ê–ô –ò –¢–ê–ù–¶–£–ô */
  dance_grace:{title:'–†–∞—Å–∫—Ä—ã–≤–∞–µ–º –∂–µ–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å',cat:'–®–∞–≥–∞–π –∏ —Ç–∞–Ω—Ü—É–π',desc:'–¢–∞–Ω—Ü–µ–≤–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∫–∏, –ø–ª–∞—Å—Ç–∏–∫–∞ –∏ –≥—Ä–∞—Ü–∏—è.',workouts:9,duration:'15‚Äì45 –º–∏–Ω',steps:'2000‚Äì3000',tempo:'—Å—Ä–µ–¥–Ω–∏–π',type:'dance',freq:3},
  dance_learn:{title:'–£—á–∏–º—Å—è —Ç–∞–Ω—Ü–µ–≤–∞—Ç—å',cat:'–®–∞–≥–∞–π –∏ —Ç–∞–Ω—Ü—É–π',desc:'–í—ã—É—á–∏—Ç–µ —Ç–∞–Ω—Ü–µ–≤–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∫–∏ –∏ –Ω–∞–±–∏—Ä–∞–π—Ç–µ —à–∞–≥–∏.',workouts:4,duration:'25‚Äì30 –º–∏–Ω',steps:'2000‚Äì3000',tempo:'—Å—Ä–µ–¥–Ω–∏–π',type:'dance',freq:3},
  dance_mix:{title:'–®–∞–≥–∞–π –∏ —Ç–∞–Ω—Ü—É–π',cat:'–®–∞–≥–∞–π –∏ —Ç–∞–Ω—Ü—É–π',desc:'–®–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ —Ç–∞–Ω—Ü–∞.',workouts:6,duration:'5‚Äì40 –º–∏–Ω',steps:'1000‚Äì4000',tempo:'–Ω–∏–∑–∫–∏–π‚Äì—Å—Ä–µ–¥–Ω–∏–π',type:'dance',freq:3},
  dance_fitness:{title:'–¢–∞–Ω—Ü–µ–≤–∞–ª—å–Ω—ã–π —Ñ–∏—Ç–Ω–µ—Å',cat:'–®–∞–≥–∞–π –∏ —Ç–∞–Ω—Ü—É–π',desc:'–≠—Å—Ç–µ—Ç–∏–∫–∞ —Ç–∞–Ω—Ü–∞ + –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –≤—Å—ë —Ç–µ–ª–æ.',workouts:12,duration:'20‚Äì50 –º–∏–Ω',steps:'3000‚Äì4000',tempo:'—Å—Ä–µ–¥–Ω–∏–π',type:'dance',freq:4},
  zumba:{title:'–ó—É–º–±–∞–≤–∏–¥–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏',cat:'–®–∞–≥–∞–π –∏ —Ç–∞–Ω—Ü—É–π',desc:'–§–∏—Ç–Ω–µ—Å-–≤–µ—á–µ—Ä–∏–Ω–∫–∞ —Å –ø–æ–ª—å–∑–æ–π –¥–ª—è —Ñ–∏–≥—É—Ä—ã.',workouts:7,duration:'20‚Äì60 –º–∏–Ω',steps:'3000‚Äì6000',tempo:'–≤—ã—Å–æ–∫–∏–π',type:'dance',freq:4},

  /* –®–ê–ì–ê–¢–ï–õ–¨–ù–´–ô –§–ò–¢–ù–ï–° */
  abs_flat:{title:'–ü–ª–æ—Å–∫–∏–π –∂–∏–≤–æ—Ç',cat:'–®–∞–≥–∞—Ç–µ–ª—å–Ω—ã–π —Ñ–∏—Ç–Ω–µ—Å',desc:'–®–∞–≥–∏ + —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –Ω–∞ –ø—Ä–µ—Å—Å.',workouts:6,duration:'15‚Äì25 –º–∏–Ω',steps:'1000‚Äì2000',tempo:'–≤—ã—Å–æ–∫–∏–π',type:'fitness',freq:4},
  strong_body:{title:'–°–∏–ª—å–Ω–æ–µ –∏ —Ä–µ–ª—å–µ—Ñ–Ω–æ–µ —Ç–µ–ª–æ',cat:'–®–∞–≥–∞—Ç–µ–ª—å–Ω—ã–π —Ñ–∏—Ç–Ω–µ—Å',desc:'–°–∏–ª–æ–≤—ã–µ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.',workouts:8,duration:'15‚Äì25 –º–∏–Ω',steps:'1000‚Äì2500',tempo:'–≤—ã—Å–æ–∫–∏–π',type:'fitness',freq:4},
  glutes_legs:{title:'–ö—Ä–∞—Å–∏–≤—ã–µ —è–≥–æ–¥–∏—Ü—ã –∏ —Å—Ç—Ä–æ–π–Ω—ã–µ –Ω–æ–≥–∏',cat:'–®–∞–≥–∞—Ç–µ–ª—å–Ω—ã–π —Ñ–∏—Ç–Ω–µ—Å',desc:'–°–∏–ª–æ–≤–∞—è –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≥ –∏ —è–≥–æ–¥–∏—Ü.',workouts:8,duration:'15‚Äì40 –º–∏–Ω',steps:'1000‚Äì4000',tempo:'–≤—ã—Å–æ–∫–∏–π',type:'fitness',freq:4},
  taebo:{title:'–í —Å—Ç–∏–ª–µ —Ç–∞–π-–±–æ',cat:'–®–∞–≥–∞—Ç–µ–ª—å–Ω—ã–π —Ñ–∏—Ç–Ω–µ—Å',desc:'–î–≤–∏–∂–µ–Ω–∏—è –≤ —Å—Ç–∏–ª–µ –±–æ–∫—Å–∞/–∫–∏–∫–±–æ–∫—Å–∏–Ω–≥–∞.',workouts:12,duration:'10‚Äì25 –º–∏–Ω',steps:'1000‚Äì2000',tempo:'—Å—Ä–µ–¥–Ω–∏–π',type:'fitness',freq:5},
  lymph:{title:'–õ–∏–º—Ñ–æ–¥—Ä–µ–Ω–∞–∂–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏',cat:'–®–∞–≥–∞—Ç–µ–ª—å–Ω—ã–π —Ñ–∏—Ç–Ω–µ—Å',desc:'–ò–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç –æ—Ç—ë–∫–æ–≤ –∏ —Ç—è–∂–µ—Å—Ç–∏.',workouts:10,duration:'15‚Äì30 –º–∏–Ω',steps:'~2000',tempo:'—Å—Ä–µ–¥–Ω–∏–π',type:'fitness',freq:3},
  tabata:{title:'–®–∞–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–∞—Ç–∞',cat:'–®–∞–≥–∞—Ç–µ–ª—å–Ω—ã–π —Ñ–∏—Ç–Ω–µ—Å',desc:'–ò–Ω—Ç–µ—Ä–≤–∞–ª—ã 20/10 –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.',workouts:21,duration:'15‚Äì30 –º–∏–Ω',steps:'1000‚Äì4000',tempo:'–Ω–∏–∑–∫–∏–π‚Äì–≤—ã—Å–æ–∫–∏–π',type:'fitness',freq:5},
  intervals:{title:'–ò–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏',cat:'–®–∞–≥–∞—Ç–µ–ª—å–Ω—ã–π —Ñ–∏—Ç–Ω–µ—Å',desc:'–°–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Å–∞ + –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å.',workouts:6,duration:'25 –º–∏–Ω',steps:'1000',tempo:'—Å—Ä–µ–¥–Ω–∏–π‚Äì–≤—ã—Å–æ–∫–∏–π',type:'fitness',freq:4},

  /* –®–ê–ì–ê–¢–ï–õ–¨–ù–ê–Ø –ê–≠–†–û–ë–ò–ö–ê */
  aero_active:{title:'–®–ê–ì–ê–ô –î–û–ú–ê. –ê–∫—Ç–∏–≤–Ω–æ',cat:'–®–∞–≥–∞—Ç–µ–ª—å–Ω–∞—è –∞—ç—Ä–æ–±–∏–∫–∞',desc:'–î–æ–ª–≥–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è —Ö–æ–¥—å–±–∞ –±–µ–∑ —Ç–∞–Ω—Ü–µ–≤.',workouts:7,duration:'15‚Äì40 –º–∏–Ω',steps:'2000‚Äì6000',tempo:'–≤—ã—Å–æ–∫–∏–π',type:'aero',freq:5},
  aero_base:{title:'–®–ê–ì–ê–ô –î–û–ú–ê. –ë–∞–∑–∞',cat:'–®–∞–≥–∞—Ç–µ–ª—å–Ω–∞—è –∞—ç—Ä–æ–±–∏–∫–∞',desc:'–ü—Ä–æ—Å—Ç–æ–π —Ñ–æ—Ä–º–∞—Ç –±–µ–∑ —Ä–∞–∑—É—á–∏–≤–∞–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏–π.',workouts:8,duration:'15‚Äì20 –º–∏–Ω',steps:'2000‚Äì2500',tempo:'–Ω–∏–∑–∫–∏–π',type:'aero',freq:3},
  plus100:{title:'–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –¥–ª—è 100+ –∫–≥',cat:'–®–∞–≥–∞—Ç–µ–ª—å–Ω–∞—è –∞—ç—Ä–æ–±–∏–∫–∞',desc:'–ú—è–≥–∫–∏–µ –∏ –Ω–µ–±—ã—Å—Ç—Ä—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞.',workouts:7,duration:'15‚Äì20 –º–∏–Ω',steps:'2000‚Äì2500',tempo:'–Ω–∏–∑–∫–∏–π',type:'aero',freq:3},
  retro:{title:'–ê—ç—Ä–æ–±–∏–∫–∞ ¬´–í—Å—ë —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è¬ª',cat:'–®–∞–≥–∞—Ç–µ–ª—å–Ω–∞—è –∞—ç—Ä–æ–±–∏–∫–∞',desc:'–†–µ—Ç—Ä–æ-—Å—Ç–∏–ª—å 80-—Ö, –¥–∏–Ω–∞–º–∏–∫–∞ –∏ —Å—Ç–∏–ª—å.',workouts:9,duration:'13‚Äì25 –º–∏–Ω',steps:'2000‚Äì4000',tempo:'—Å—Ä–µ–¥–Ω–∏–π',type:'aero',freq:4},
  fifty:{title:'–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –¥–ª—è 50+',cat:'–®–∞–≥–∞—Ç–µ–ª—å–Ω–∞—è –∞—ç—Ä–æ–±–∏–∫–∞',desc:'–ë–µ—Ä–µ–∂–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞, –∑–¥–æ—Ä–æ–≤—å–µ —Å—É—Å—Ç–∞–≤–æ–≤.',workouts:7,duration:'15‚Äì20 –º–∏–Ω',steps:'2000‚Äì2500',tempo:'—Å—Ä–µ–¥–Ω–∏–π',type:'aero',freq:3},

  /* –ö–ê–†–î–ò–û –ó–ê–†–Ø–î–ö–ò */
  hits:{title:'–®–∞–≥–∞–π –ø–æ–¥ —Ö–∏—Ç—ã',cat:'–ö–∞—Ä–¥–∏–æ –∑–∞—Ä—è–¥–∫–∏',desc:'–ö–æ—Ä–æ—Ç–∫–∏–µ –∑–∞—Ä—è–¥–∫–∏ –ø–æ–¥ –ª—é–±–∏–º—ã–µ –ø–µ—Å–Ω–∏.',workouts:72,duration:'3‚Äì6 –º–∏–Ω',steps:'200‚Äì600',tempo:'–Ω–∏–∑–∫–∏–π',type:'cardio',freq:7},
  warmups:{title:'–ö–∞—Ä–¥–∏–æ-—Ä–∞–∑–º–∏–Ω–∫–∏',cat:'–ö–∞—Ä–¥–∏–æ –∑–∞—Ä—è–¥–∫–∏',desc:'–ë–æ–¥—Ä—ã–µ –º–∏–Ω–∏-—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ 5 –º–∏–Ω—É—Ç.',workouts:5,duration:'2‚Äì5 –º–∏–Ω',steps:'200‚Äì600',tempo:'—Å—Ä–µ–¥–Ω–∏–π',type:'cardio',freq:5},

  /* –î–†–£–ì–û–ï */
  stretch:{title:'–†–∞—Å—Ç—è–∂–∫–∏ –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è',cat:'–î—Ä—É–≥–æ–µ',desc:'–ì–∏–±–∫–æ—Å—Ç—å, –ª—ë–≥–∫–æ—Å—Ç—å –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ.',workouts:5,duration:'10‚Äì40 –º–∏–Ω',steps:'‚Äî',tempo:'–Ω–∏–∑–∫.‚Äì—Å—Ä–µ–¥–Ω.',type:'other',freq:3},
  back:{title:'–ó–¥–æ—Ä–æ–≤–∞—è —Å–ø–∏–Ω–∞',cat:'–î—Ä—É–≥–æ–µ',desc:'–£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–ø–∏–Ω—ã –∏ –æ—Å–∞–Ω–∫–∏.',workouts:12,duration:'15‚Äì20 –º–∏–Ω',steps:'‚Äî',tempo:'–Ω–∏–∑–∫.‚Äì—Å—Ä–µ–¥–Ω.',type:'other',freq:3},
};

/* –≤—ã–±–æ—Ä 4 –ø—Ä–æ–≥—Ä–∞–º–º –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
function chooseProgramKeys(){
  const age=A.age||'', exp=A.exp||'', life=A.life||'', bmi=+A.bmi||0, w=+A.w||0, steps=+A.steps||0, keep=!!A.keep, goal=+A.goalKg||0;
  const list=[]; const push=k=>{if(k && !list.includes(k)) list.push(k)};

  if(/50\+/.test(age)) push('fifty');
  if(bmi>=35 || w>=100){push('plus100'); push('aero_base');}
  if(keep || goal===0){push('strong_body'); push('glutes_legs'); push('dance_fitness'); push('stretch');}
  if(/–ù–∏–∫–æ–≥–¥–∞/.test(exp)||/–°–∏–¥—è—á–∞—è/.test(life)||steps<4000){push('aero_base'); push('dance_mix');}
  if(/–†–µ–≥—É–ª—è—Ä–Ω–æ/.test(exp) && (/–ê–∫—Ç–∏–≤–Ω–∞—è/.test(life)||steps>8000) && !keep && goal>=5){push('tabata'); push('intervals'); push('aero_active');}
  push('dance_grace');
  const fallback=['aero_active','taebo','abs_flat','zumba','back','warmups','lymph','retro','hits'];
  for(const k of fallback){ if(list.length>=4) break; push(k); }
  return list.slice(0,4);
}

/* —Ä–µ–Ω–¥–µ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫ –≤—ã–±–æ—Ä–∞ */
function renderProgSelect(){
  const grid=$('#progGrid'); const keys=A.recKeys || chooseProgramKeys(); A.recKeys=keys; save();
  const rec=keys[0];
  grid.innerHTML = keys.map(k=>{
    const p=CATALOG[k];
    return `<div class="pcard${k===rec?' is':''}" data-k="${k}">
      ${k===rec?'<div class="rec">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º</div>':''}
      <span class="tag">${p.cat}</span>
      <h3>${p.title}</h3>
      <div class="meta">${p.desc}</div>
      <div class="meta" style="margin-top:6px">‚Ä¢ –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: <b>${p.workouts}</b> ¬∑ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: <b>${p.duration}</b><br>‚Ä¢ –®–∞–≥–æ–≤ –∑–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É: <b>${p.steps}</b> ¬∑ –¢–µ–º–ø: <b>${p.tempo}</b></div>
      <div class="actions" style="margin-top:8px"><button class="btn ghost" data-choose="${k}" type="button">–í—ã–±—Ä–∞—Ç—å</button></div>
    </div>`;
  }).join('');
  grid.onclick=e=>{const b=e.target.closest('[data-choose]'); if(!b) return; const k=b.dataset.choose; A.progKey=k; save(); $$('.pcard',grid).forEach(c=>c.classList.toggle('is',c.dataset.k===k));};
  if(!A.progKey) A.progKey=rec;
}

/* –Ω–µ–¥–µ–ª—è –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ */
function renderProgram(){
  const key=A.progKey || (A.recKeys?A.recKeys[0]:chooseProgramKeys()[0]); const p=CATALOG[key];
  if(!p){$('#weekGrid').innerHTML=''; return;}
  $('#progTitle').textContent = `¬´${p.title}¬ª ‚Äî –ø—Ä–∏–º–µ—Ä –≤–∞—à–µ–π –Ω–µ–¥–µ–ª–∏`;
  const freq = freqFromPerweek() || p.freq || 3;
  $('#progLead').innerHTML = `${p.cat} ‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è <b>${freq}</b> —Ä–∞–∑(–∞) –≤ –Ω–µ–¥–µ–ª—é ¬∑ ${p.desc}`;
  const days=['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'];
  let trainIdx=[];
  if(freq===2) trainIdx=[1,4]; else if(freq===3) trainIdx=[0,2,5]; else if(freq===4) trainIdx=[0,2,4,6]; else if(freq===5) trainIdx=[0,1,3,5,6]; else trainIdx=[0,1,2,3,4,5];
  const grid=$('#weekGrid');
  const titleByType={dance:'–¢–∞–Ω—Ü–µ–≤–∞–ª—å–Ω–∞—è —à–∞–≥–∞—Ç–µ–ª—å–Ω–∞—è',fitness:'–®–∞–≥–∏ + —Å–∏–ª–æ–≤—ã–µ',aero:'–ê—ç—Ä–æ–±–Ω–∞—è —Ö–æ–¥—å–±–∞',cardio:'–ö–∞—Ä–¥–∏–æ-–∑–∞—Ä—è–¥–∫–∞',other:'–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ'};
  const addByType={dance:'—Ä–∞–∑–±–æ—Ä/—Å–≤—è–∑–∫–∏ –ø–æ–¥ –º—É–∑—ã–∫—É',fitness:'20‚Äì30 –º–∏–Ω ‚Ä¢ –∫–æ—Ä–ø—É—Å/—è–≥–æ–¥–∏—Ü—ã',aero:'–¥–ª–∏—Ç–µ–ª—å–Ω–∞—è —Ö–æ–¥—å–±–∞ 20‚Äì40 –º–∏–Ω',cardio:'5‚Äì10 –º–∏–Ω –±–æ–¥—Ä–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏',other:'—Ä–∞—Å—Ç—è–∂–∫–∞/–∑–¥–æ—Ä–æ–≤–∞—è —Å–ø–∏–Ω–∞'};
  grid.innerHTML = days.map((d,i)=>{
    const train=trainIdx.includes(i);
    if(!train) return `<div class="day"><h4>${d}</h4><span class="badge badge-rest">–ü—Ä–æ–≥—É–ª–∫–∞ / –æ—Ç–¥—ã—Ö</span><div class="hint">5‚Äì8 —Ç—ã—Å. —à–∞–≥–æ–≤ –≤ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ</div></div>`;
    return `<div class="day"><h4>${d}</h4><span class="badge badge-tr">${titleByType[p.type]}</span><div class="hint">${addByType[p.type]}</div></div>`;
  }).join('');
}

/* ========= Trial mount ========= */
function mountTrial(){
  const tabs=$('#trialTabs'), frame=$('#trialFrame');
  tabs.innerHTML=['vk','yt','rt'].map((k,i)=>`<button class="p-btn${i?'':' is'}" data-k="${k}">${{vk:'VK –í–∏–¥–µ–æ',yt:'YouTube',rt:'RuTube'}[k]}</button>`).join('');
  function sel(k){tabs.querySelectorAll('.p-btn').forEach(b=>b.classList.toggle('is',b.dataset.k===k));frame.innerHTML=`<iframe src="${EMBEDS[k]}" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>`}
  tabs.onclick=e=>{const b=e.target.closest('.p-btn'); if(b) sel(b.dataset.k)};
  sel('vk');
  $('#trialCtaText').innerHTML = `<b>–£–∑–Ω–∞–π—Ç–µ, –Ω–∞ —Å–∫–æ–ª—å–∫–æ –≤—ã –ø–æ—Ö—É–¥–µ–µ—Ç–µ, –µ—Å–ª–∏ –±—É–¥–µ—Ç–µ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –ø–æ —Ç–∞–∫–∏–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º ${perweekLabel()}.</b>`;
}

/* ========= Loading & Calculate ========= */
function runLoading(done){
  const lp=$('#lp'),pct=$('#lpct'),msg=$('#lmsg');const T=1500,t0=performance.now();
  const steps=['–í–æ–∑—Ä–∞—Å—Ç –∏ –ò–ú–¢','–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –æ–ø—ã—Ç','–¶–µ–ª—å –∏ –ø–∏—Ç–∞–Ω–∏–µ','–ì–æ—Ç–æ–≤–∏–º –ø—Ä–æ–≥–Ω–æ–∑‚Ä¶'];
  requestAnimationFrame(function tick(t){const p=Math.min(1,(t-t0)/T);pct.textContent=Math.round(5+95*(1-Math.pow(1-p,3)))+'%';msg.textContent=steps[Math.min(steps.length-1,Math.floor(p*steps.length))];lp.style.background=`conic-gradient(var(--o) ${Math.round(p*360)}deg,#eee 0)`;if(p<1)requestAnimationFrame(tick);else setTimeout(done,200)})
}
function calculate(){
  const name=A.name?.trim()||'–î—Ä—É–∑—å—è'; const keep=!!A.keep; const kg=goalKg(); const r=rate(); const w=Math.max(4,Math.min(16,Math.ceil((keep?4:kg)/r))); const d=fmtDur(w);
  $('#rTitle').textContent=`${name}, –≤–∞—à –ø—Ä–æ–≥–Ω–æ–∑ –≥–æ—Ç–æ–≤ ‚ú®`;
  if(keep||kg===0){$('#nums').textContent=`–ß—Ç–æ–±—ã –ø—Ä–∏–π—Ç–∏ –∫ —Ü–µ–ª–∏ –∑–∞ ${d.v} ${d.u}`;$('#rSub').innerHTML=`–°—Ñ–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ <b>—Ç–æ–Ω—É—Å–µ –∏ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏</b>.`;}
  else{$('#nums').textContent=`‚àí${kg} –∫–≥ –∑–∞ ${d.v} ${d.u}`;$('#rSub').innerHTML=`–° –®–ê–ì–ê–ô –î–û–ú–ê ‚ö° –≤—ã –±—É–¥–µ—Ç–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å <b>${(+A.steps+2000).toLocaleString('ru-RU')}</b> —à–∞–≥–æ–≤ –≤ –¥–µ–Ω—å.`;}
  renderCase(kg,keep);
  startTimers();
  A.recKeys = chooseProgramKeys(); save();
  $('#sLead').innerHTML = keep? '–ì–æ—Ç–æ–≤—ã–µ –ø–ª–∞–Ω—ã –Ω–∞ —Ç–æ–Ω—É—Å –∏ –º—ã—à—Ü—ã, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –ø–æ–º–æ–≥—É—Ç –≤–∞–º –¥–µ—Ä–∂–∞—Ç—å —Ä–∏—Ç–º.' : `–ß—Ç–æ–±—ã –ø—Ä–∏–π—Ç–∏ –∫ —Ü–µ–ª–∏ <b>‚àí${kg} –∫–≥</b> ‚Äî –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–µ –ø–ª–∞–Ω—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É.`;
  show(idxBy('result'));
}

/* ========= Timers ========= */
function getDeadline(){let t=+localStorage.getItem('sdq_offer_deadline15')||0;const now=Date.now();if(!t||t<now){t=now+15*60*1000;localStorage.setItem('sdq_offer_deadline15',String(t))}return t}
function fmt(ms){let s=Math.max(0,Math.floor(ms/1000)),m=Math.floor(s/60);s%=60;return String(m).padStart(2,'0')+':'+String(s).padStart(2,'0')}
let timerI=null;function startTimers(){if(timerI)clearInterval(timerI);const dl=getDeadline();const t1=$('#inlineTimer'),t2=$('#saleTimer');function tick(){const left=dl-Date.now();const v=fmt(left);t1&&(t1.textContent=v);t2&&(t2.textContent=v);if(left<=0)clearInterval(timerI)}tick();timerI=setInterval(tick,1000)}

/* ========= Init ========= */
$('#start').onclick=()=>show(1);
$('#start').focus();
startTimers();
</script>
</body>
</html>
